import{a as ie}from"./chunk-BKTAQ5YZ.js";import{a as ce}from"./chunk-GOI4EBGB.js";import{b as ae,c as re}from"./chunk-V5S3SSVI.js";import{a as te}from"./chunk-YALSPSUR.js";import{b as $}from"./chunk-KLFVQY4H.js";import{j as oe,m as le,n as pe}from"./chunk-DHXFVDEA.js";import{A as d,Aa as f,Ba as x,Da as A,E as v,Ea as D,Fa as O,Fc as ne,Gc as se,Hb as q,Kb as H,Lb as R,N as u,Nb as L,O as S,Rb as Q,U as w,Wb as Y,X as h,Xa as F,Z as r,Za as W,_b as G,a as E,aa as j,ac as J,cb as N,d as M,da as s,ea as a,eb as z,ja as b,ka as _,la as l,lc as K,mc as X,nc as Z,o as I,oc as ee,ra as B,s as p,sa as P,t as k,ta as V,va as c,y as T,yb as U,z as m,za as g}from"./chunk-KWICCDR6.js";var me=(()=>{class n{constructor(){this.socket=p(te),this.userService=p($),this.http=p(z),this.api=p(R),this.notificationService=p(H),this.cashBalanceService=p(ie),this.expensesAccounts=w([]),this.loading_table=w(!1),this.status_action$=new M({}),this.socketId=this.userService.socketId,this.getExpensesAccounts(),this.initializeSockets()}getExpensesAccounts(){this.loading_table.set(!0),this.http.get(`${this.api.host()}/expense/accounts`).subscribe({next:e=>{this.expensesAccounts.set(e)},error:e=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}submitExpensePayment(e){this.loading_table.set(!0),this.http.post(`${this.api.host()}/expense/create`,e).subscribe({next:t=>{this.notificationService.showSuccess(t.message,"home"),this.status_action$.next({action:"ADD"}),this.cashBalanceService.getBalance()},error:t=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}submitExpenseEditPayment(e){this.loading_table.set(!0),this.http.put(`${this.api.host()}/expense`,e).subscribe({next:t=>{this.notificationService.showSuccess("Payment updated successfully","home"),this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance()},error:t=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}deletePayment(e){this.loading_table.set(!0),this.http.delete(`${this.api.host()}/expense/${e}`).subscribe({next:t=>{this.status_action$.next({action:"DELETE"}),this.cashBalanceService.getBalance()},error:t=>{this.loading_table.set(!1),this.notificationService.showError(t.error,"home")},complete:()=>{this.loading_table.set(!1),this.notificationService.showSuccess("Payment deleted successfully","home")}})}initializeSockets(){this.socket.on("expenseCreated",e=>{e.user_id!=this.socketId()&&(this.status_action$.next({action:"ADD"}),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("New expense created!","home"))}),this.socket.on("expenseUpdated",e=>{e.user_id!=this.socketId()&&(this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An expense record has been updated!","home"))}),this.socket.on("expenseUpdated",e=>{e.user_id!=this.socketId()&&(this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An expense record has been deleted!","home"))})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var _e=["amountInput"],he=()=>({width:"75vw"}),ge=()=>({"1199px":"85vw","575px":"95vw"}),fe=n=>({"ng-invalid ng-dirty":n});function xe(n,y){n&1&&(s(0,"small",15),c(1,"Date is required."),a())}function ye(n,y){n&1&&(s(0,"small",15),c(1,"Ammount is required."),a())}function be(n,y){if(n&1){let e=b();s(0,"div",4)(1,"div",5)(2,"div",6)(3,"label",7),c(4,"Description"),s(5,"span",8),c(6," *"),a()(),s(7,"input",9),x("ngModelChange",function(i){m(e);let o=l();return f(o.journal_description,i)||(o.journal_description=i),d(i)}),a()()(),s(8,"div",5)(9,"label",10),c(10,"Payment Date"),s(11,"span",8),c(12," *"),a()(),s(13,"p-calendar",11),x("ngModelChange",function(i){m(e);let o=l();return f(o.payment_date,i)||(o.payment_date=i),d(i)}),a(),h(14,xe,2,0,"small",12),a(),s(15,"div",5)(16,"div",6)(17,"label",13),c(18,"Amount"),s(19,"span",8),c(20," *"),a()(),s(21,"p-inputNumber",14,0),x("ngModelChange",function(i){m(e);let o=l();return f(o.amount,i)||(o.amount=i),d(i)}),_("onFocus",function(i){m(e);let o=l();return d(o.selectInput(i))}),a(),h(23,ye,2,0,"small",12),a()()()}if(n&2){let e=l();u(7),g("ngModel",e.journal_description),u(6),g("ngModel",e.payment_date),r("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0),u(),r("ngIf",e.submitted&&!e.payment_date),u(7),g("ngModel",e.amount),r("required",!0)("ngClass",O(11,fe,e.submitted&&!e.amount)),u(2),r("ngIf",e.submitted&&!e.amount)}}function Ce(n,y){if(n&1){let e=b();s(0,"p-button",19),_("onClick",function(){m(e);let i=l(2);return d(i.deletePayment())}),a()}if(n&2){let e=l(2);r("disabled",e.loading())}}function ve(n,y){if(n&1){let e=b();h(0,Ce,1,1,"p-button",16),s(1,"p-button",17),_("onClick",function(){m(e);let i=l();return d(i.closeDialog())}),a(),s(2,"p-button",18),_("onClick",function(){m(e);let i=l();return d(i.submitPayment())}),a()}if(n&2){let e=l();r("ngIf",e.dialog_mode==="edit"),u(),r("disabled",e.loading()),u(),r("loading",e.loading())}}var tt=(()=>{class n{constructor(e,t){this.expensesService=e,this.confirmationService=t,this.visible=!1,this.dialog_mode="add",this.OnClose=new v,this.OnSubmit=new v,this.dateService=p(ce),this.expensesAccounts=this.expensesService.expensesAccounts,this.loading=this.expensesService.loading_table,this.submitted=!1,this.payment_date=this.dateService.getCurrentDatetime(),this.amount=null,this.subscriptions=new E}initDialog(){this.submitted=!1,this.amount=null,this.journal_description=null}closeDialog(){this.OnClose.emit(),this.initDialog()}ngOnInit(){this.subscriptions.add(this.expensesService.status_action$.subscribe(e=>{e.action&&(this.OnSubmit.emit(),this.initDialog(),this.visible=!1,this.expensesService.status_action$.next({}))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.dialog_mode==="edit"&&this.selected_payment?(this.journal_description=this.selected_payment.journal_description,this.amount=this.selected_payment.total_value,this.payment_date=this.dateService.formatDate(this.selected_payment.payment_date,"YYYY-MM-DD HH:mm")):this.visible&&this.dialog_mode==="add"&&(this.payment_date=this.dateService.getCurrentDatetime())}deletePayment(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.expensesService.deletePayment(this.selected_payment.journal_id)}})}submitPayment(){this.submitted=!0,this.amount>0&&this.payment_date&&this.journal_description&&(this.payment_date=this.dateService.formatDate(this.payment_date),this.dialog_mode==="add"?this.expensesService.submitExpensePayment({amount:this.amount,journal_description:this.journal_description,payment_date:this.payment_date}):this.expensesService.submitExpenseEditPayment({amount:this.amount,journal_description:this.journal_description,payment_date:this.payment_date,journal_id:this.selected_payment.journal_id}))}selectInput(e){e.target.select()}static{this.\u0275fac=function(t){return new(t||n)(S(me),S(U))}}static{this.\u0275cmp=k({type:n,selectors:[["expenses-dialog"]],viewQuery:function(t,i){if(t&1&&B(_e,5),t&2){let o;P(o=V())&&(i.amountInput=o.first)}},inputs:{visible:"visible",dialog_mode:"dialog_mode",selected_payment:"selected_payment"},outputs:{OnClose:"OnClose",OnSubmit:"OnSubmit"},standalone:!0,features:[T,A],decls:3,vars:10,consts:[["amountInput",""],["position","top","header","Submit Expense","styleClass","p-fluid",3,"visibleChange","onHide","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],[1,"flex","flex-column","gap-2"],["for","Type"],[1,"text-red-500"],["type","text","pInputText","",3,"ngModelChange","ngModel"],["for","payment_date"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","showTime"],["class","p-error",4,"ngIf"],["for","amount"],["styleClass","input-align-center","mode","currency","currency","USD","locale","en-US","step","0",1,"p-inputtext-sm",3,"ngModelChange","onFocus","ngModel","required","ngClass"],[1,"p-error"],["pRipple","","size","small","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"disabled","onClick",4,"ngIf"],["pRipple","","size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","disabled"],["pRipple","","size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading"],["pRipple","","size","small","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"]],template:function(t,i){t&1&&(s(0,"p-dialog",1),x("visibleChange",function(C){return f(i.visible,C)||(i.visible=C),C}),_("onHide",function(){return i.closeDialog()}),h(1,be,24,13,"ng-template",2)(2,ve,3,3,"ng-template",3),a()),t&2&&(j(D(8,he)),r("modal",!0),g("visible",i.visible),r("breakpoints",D(9,ge))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[se,ne,q,X,K,oe,pe,le,re,ae,J,L,Q,G,Y,N,F,W,ee,Z]})}}return n})();export{tt as a};
