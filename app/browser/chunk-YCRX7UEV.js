import{a as Se,b as ye}from"./chunk-FFORXAGK.js";import{a as Ee,b as Ve}from"./chunk-PXVOD3QY.js";import"./chunk-SPKEVXDM.js";import{b as Ue}from"./chunk-V7IGKE33.js";import"./chunk-YW57MKXO.js";import{a as be,b as xe}from"./chunk-6OAFLMEG.js";import{c as ge,f as ve,i as we,q as Ce}from"./chunk-V5RHMPQH.js";import{i as fe,j as he}from"./chunk-LH73PZKM.js";import{$b as ne,A as _,Aa as A,Ba as G,Ea as x,Fa as F,Fc as ue,Gc as _e,Hb as K,Kb as Y,Lb as J,N as r,Nb as X,Pb as S,Rb as Z,Sb as ee,U as v,X as w,Xa as W,Xb as te,Yb as ie,Z as p,Za as z,Zb as oe,_b as se,a as I,aa as H,ac as re,bc as le,c as R,ca as C,cb as Q,da as o,ea as i,eb as $,fa as a,ja as b,ka as f,kc as ae,la as d,lc as me,mc as pe,nc as de,o as L,oc as ce,p as E,ra as j,s as h,sa as P,t as O,ta as B,tb as D,u as V,ua as k,va as l,wa as U,yb as T,z as u,za as q}from"./chunk-4RWQR7BF.js";import"./chunk-WWX6BADO.js";var Fe=(()=>{class t{constructor(){this.http=h($),this.api=h(J),this.notificationService=h(Y),this.host=this.api.host,this.userDialogVisible=v(!1),this.users=v([]),this.usersLoading=v(!1),this.loading=v(!1),this.selectedUser=v(null),this.existedUsernameError=new R,this.getUsers()}getUsers(){this.usersLoading.set(!0),this.http.get(`${this.host()}/users`).subscribe({next:e=>{console.log(e),this.users.set(e),this.usersLoading.set(!1)},error:e=>{this.usersLoading.set(!1),this.notificationService.handleError(e.error,"home")}})}createUser(e){this.usersLoading.set(!0),this.http.post(`${this.host()}/users`,e).subscribe({next:s=>{this.users.set([...this.users(),s]),this.loading.set(!1),this.usersLoading.set(!1),this.userDialogVisible.set(!1),this.notificationService.showSuccess("User added successfully!","home")},error:s=>{s.status==406?(this.loading.set(!1),this.existedUsernameError.next()):this.notificationService.handleError(s.error,"home"),this.usersLoading.set(!1)}})}updateUser(e){this.http.put(`${this.host()}/users`,e).subscribe({next:s=>{this.users.update(n=>{let c=this.users().findIndex(g=>g.user_id===e.user_id);return[...n.slice(0,c),s,...n.slice(c+1)]}),this.userDialogVisible.set(!1),this.selectedUser.set(e),this.loading.set(!1),this.notificationService.showSuccess("User updated successfully!","home")},error:s=>{s.status==406?this.existedUsernameError.next():this.notificationService.handleError(s.error,"home"),this.loading.set(!1)}})}deleteUser(e){this.http.delete(`${this.host()}/users/${e.user_id}`).subscribe({next:s=>{this.users.update(n=>{let c=this.users().findIndex(g=>g.user_id===e.user_id);return n.splice(c,1),[...n]}),this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home")}})}static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275prov=L({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var De=["name"],Me=()=>[10,15,50,100],Ne=()=>["username","first_name","last_name"],Te=()=>({width:"50vw"}),Ie=()=>({"1199px":"75vw","575px":"95vw"}),N=t=>({"ng-invalid ng-dirty":t});function Re(t,m){if(t&1){let e=b();o(0,"div",16)(1,"span",17),a(2,"i",18),o(3,"input",19,1),f("input",function(n){u(e),d();let c=k(6);return _(c.filterGlobal(n.target.value,"contains"))}),i()()(),o(5,"p-button",20),f("onClick",function(){u(e);let n=d();return _(n.refresh())}),i(),o(6,"p-button",21),f("onClick",function(){u(e);let n=d();return _(n.openUserDialog("add"))}),i()}if(t&2){d();let e=k(6);r(3),p("value",e.filters.global==null?null:e.filters.global.value)}}function Le(t,m){if(t&1){let e=b();o(0,"p-button",22),f("onClick",function(){u(e);let n=d();return _(n.openUserDialog("edit"))}),i(),o(1,"p-button",23),f("onClick",function(){u(e);let n=d();return _(n.deleteSelectedUser())}),i()}if(t&2){let e=d();p("disabled",!e.selectedUser()),r(),p("disabled",!e.selectedUser())}}function Oe(t,m){t&1&&(o(0,"tr")(1,"th",24),l(2,"Username"),i(),o(3,"th",24),l(4,"First Name"),i(),o(5,"th",24),l(6,"Last Name"),i(),o(7,"th",24),l(8,"Last Login"),i(),o(9,"th",25),l(10,"Permissions"),i()(),o(11,"tr")(12,"th"),l(13,"Show Stock"),i(),o(14,"th"),l(15,"Show Cost"),i(),o(16,"th"),l(17,"Edit Invoice"),i(),o(18,"th"),l(19,"Delete Invoice"),i(),o(20,"th"),l(21,"Show Reports"),i()())}function je(t,m){t&1&&(o(0,"td"),a(1,"i",27),i())}function Pe(t,m){t&1&&(o(0,"td"),a(1,"i",28),i())}function Be(t,m){t&1&&(o(0,"td"),a(1,"i",27),i())}function qe(t,m){t&1&&(o(0,"td"),a(1,"i",28),i())}function Ae(t,m){t&1&&(o(0,"td"),a(1,"i",27),i())}function Ge(t,m){t&1&&(o(0,"td"),a(1,"i",28),i())}function We(t,m){t&1&&(o(0,"td"),a(1,"i",27),i())}function ze(t,m){t&1&&(o(0,"td"),a(1,"i",28),i())}function Qe(t,m){t&1&&(o(0,"td"),a(1,"i",27),i())}function $e(t,m){t&1&&(o(0,"td"),a(1,"i",28),i())}function Ke(t,m){if(t&1&&(o(0,"tr",26)(1,"td"),l(2),i(),o(3,"td"),l(4),i(),o(5,"td"),l(6),i(),o(7,"td"),l(8),i(),w(9,je,2,0,"td")(10,Pe,2,0,"td")(11,Be,2,0,"td")(12,qe,2,0,"td")(13,Ae,2,0,"td")(14,Ge,2,0,"td")(15,We,2,0,"td")(16,ze,2,0,"td")(17,Qe,2,0,"td")(18,$e,2,0,"td"),i()),t&2){let e=m.$implicit;p("pSelectableRow",e),r(2),U(e.username),r(2),U(e.first_name||" --- "),r(2),U(e.last_name||" --- "),r(2),U(e.last_login||"Never logged in yet!"),r(),C(e.show_stock?9:10),r(2),C(e.show_cost?11:12),r(2),C(e.edit_invoice?13:14),r(2),C(e.delete_invoice?15:16),r(2),C(e.show_reports?17:18)}}function Ye(t,m){t&1&&(o(0,"tr")(1,"td",29),l(2,"No records yet!"),i()())}function Je(t,m){if(t&1&&(o(0,"div",32)(1,"label",47),l(2,"Password*"),i(),a(3,"input",48),i()),t&2){let e=d(2);r(3),p("ngClass",F(1,N,(e.password==null?null:e.password.invalid)&&((e.password==null?null:e.password.dirty)||(e.password==null?null:e.password.touched)||e.submitted)))}}function Xe(t,m){if(t&1&&(o(0,"div",32)(1,"label",49),l(2,"Confirm Password*"),i(),a(3,"input",50),i()),t&2){let e=d(2);r(3),p("ngClass",F(1,N,(e.confirm_password==null?null:e.confirm_password.invalid)&&((e.confirm_password==null?null:e.confirm_password.dirty)||(e.confirm_password==null?null:e.confirm_password.touched)||e.submitted)))}}function Ze(t,m){if(t&1){let e=b();o(0,"form",30),f("ngSubmit",function(){u(e);let n=d();return _(n.submitUser())}),o(1,"div",31)(2,"div",32)(3,"label",33),l(4,"Username*"),i(),a(5,"input",34,2),i(),w(7,Je,4,3,"div",35)(8,Xe,4,3,"div",35),i(),o(9,"div",31)(10,"div",36)(11,"label",37),l(12,"First Name"),i(),a(13,"input",38),i(),o(14,"div",36)(15,"label",39),l(16,"Last Name"),i(),a(17,"input",40),i()(),o(18,"div",31)(19,"div",41)(20,"label"),l(21,"Show Stock?"),i(),a(22,"p-dropdown",42),i(),o(23,"div",41)(24,"label"),l(25,"Show Cost?"),i(),a(26,"p-dropdown",43),i(),o(27,"div",41)(28,"label"),l(29,"Edit Invoice?"),i(),a(30,"p-dropdown",44),i(),o(31,"div",41)(32,"label"),l(33,"Delete Invoice?"),i(),a(34,"p-dropdown",45),i(),o(35,"div",41)(36,"label"),l(37,"Show Reports"),i(),a(38,"p-dropdown",46),i()()()}if(t&2){let e=d();p("formGroup",e.userForm),r(5),p("ngClass",F(14,N,(e.username==null?null:e.username.invalid)&&((e.username==null?null:e.username.dirty)||(e.username==null?null:e.username.touched)||e.submitted))),r(2),p("ngIf",e.dialogMode=="add"),r(),p("ngIf",e.dialogMode=="add"),r(14),p("options",e.permissionOptions)("autoOptionFocus",!1),r(4),p("options",e.permissionOptions)("autoOptionFocus",!1),r(4),p("options",e.permissionOptions)("autoOptionFocus",!1),r(4),p("options",e.permissionOptions)("autoOptionFocus",!1),r(4),p("options",e.permissionOptions)("autoOptionFocus",!1)}}function et(t,m){if(t&1){let e=b();o(0,"button",51),f("click",function(){u(e);let n=d();return _(n.closeUserDialog())}),i(),o(1,"button",52),f("click",function(){u(e);let n=d();return _(n.submitUser())}),i()}if(t&2){let e=d();r(),p("loading",e.loading())}}var He=(()=>{class t{constructor(){this.usersService=h(Fe),this.confirmationService=h(T),this.fb=h(ne),this.subscriptions=new I,this.usersLoading=this.usersService.usersLoading,this.users=this.usersService.users,this.userDialogVisible=this.usersService.userDialogVisible,this.loading=this.usersService.loading,this.selectedUser=this.usersService.selectedUser,this.submitted=!1,this.permissionOptions=[{name:"Yes",value:1},{name:"No",value:0}],this.userForm=this.fb.group({user_id:[null],username:[null,S.required],password:[null],confirm_password:[null],first_name:[null],last_name:[null],show_stock:[0],show_cost:[0],edit_invoice:[0],delete_invoice:[0],show_reports:[0]})}ngOnInit(){this.usersService.selectedUser.set(null),this.subscriptions.add(this.usersService.existedUsernameError.subscribe(()=>{this.name.nativeElement.select(),this.userForm.controls.username.setErrors({error:"Username already exists"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}refresh(){this.usersService.getUsers()}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get confirm_password(){return this.userForm.get("confirm_password")}openUserDialog(e){this.dialogMode=e,this.dialogMode=="add"?this.usersService.userDialogVisible.set(!0):this.dialogMode=="edit"&&(this.userForm.patchValue(this.selectedUser()),this.usersService.userDialogVisible.set(!0))}submitUser(){this.submitted=!0,this.dialogMode=="add"?(this.userForm.controls.password.addValidators([S.required]),this.userForm.controls.confirm_password.addValidators([S.required]),this.userForm.controls.password.updateValueAndValidity(),this.userForm.controls.confirm_password.updateValueAndValidity(),this.userForm.valid&&(this.userForm.value.password===this.userForm.value.confirm_password?this.confirmationService.confirm({key:"users",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.usersService.loading.set(!0),this.usersService.createUser(this.userForm.value)},reject:()=>{this.submitted=!1}}):(this.userForm.controls.password.setErrors({error:"password didnt match!"}),this.userForm.controls.confirm_password.setErrors({error:"password didnt match!"})))):(this.userForm.controls.password.removeValidators([S.required]),this.userForm.controls.confirm_password.removeValidators([S.required]),this.userForm.controls.password.updateValueAndValidity(),this.userForm.controls.confirm_password.updateValueAndValidity(),this.userForm.valid&&(this.usersService.loading.set(!0),this.usersService.updateUser(this.userForm.value)))}deleteSelectedUser(){this.confirmationService.confirm({key:"users",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.usersService.deleteUser(this.selectedUser())}})}closeUserDialog(){this.usersService.userDialogVisible.set(!1)}resetDialog(){this.submitted=!1,this.usersService.userDialogVisible.set(!1),this.userForm.reset({show_stock:0,show_cost:0,edit_invoice:0,delete_invoice:0,show_reports:0})}selectUser(e){this.usersService.selectedUser.set(e.data)}unselectUser(){this.usersService.selectedUser.set(null)}static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275cmp=O({type:t,selectors:[["app-users-home"]],viewQuery:function(s,n){if(s&1&&j(De,5),s&2){let c;P(c=B())&&(n.name=c.first)}},decls:15,vars:21,consts:[["dt",""],["tableSearch",""],["name",""],[1,"grid","m-1"],[1,"col-12"],["styleClass","p-2"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","user_id",3,"onRowSelect","onRowUnselect","value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top","header","User","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],["key","users"],[1,"flex"],[1,"p-input-icon-left","mr-auto"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["label","Refresh","icon","pi pi-refresh","styleClass","ml-2","size","small",3,"onClick"],["label","New User","icon","pi pi-plus","severity","success","size","small","styleClass","ml-2",3,"onClick"],["label","Edit","icon","pi pi-file-edit","size","small","severity","warning","styleClass","mr-2",3,"onClick","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",3,"onClick","disabled"],["rowspan","2"],["colspan","5"],[3,"pSelectableRow"],[1,"pi","pi-check-circle","text-green-600"],[1,"pi","pi-times-circle","text-red-600"],["colspan","9"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],["for","name"],["type","text","pInputText","","formControlName","username","required","","autofocus","","spellcheck","false",3,"ngClass"],["class","field col-12 md:col-4",4,"ngIf"],[1,"field","col-12","md:col-6"],["for","first_name"],["id","first_name","type","text","pInputText","","formControlName","first_name","spellcheck","false"],["for","last_name"],["id","last_name","type","text","pInputText","","formControlName","last_name","spellcheck","false"],[1,"field","col-12","md:col-3"],["appendTo","body","formControlName","show_stock","optionLabel","name","optionValue","value",3,"options","autoOptionFocus"],["appendTo","body","formControlName","show_cost","optionLabel","name","optionValue","value",3,"options","autoOptionFocus"],["appendTo","body","formControlName","edit_invoice","optionLabel","name","optionValue","value",3,"options","autoOptionFocus"],["appendTo","body","formControlName","delete_invoice","optionLabel","name","optionValue","value",3,"options","autoOptionFocus"],["appendTo","body","formControlName","show_reports","optionLabel","name","optionValue","value",3,"options","autoOptionFocus"],["for","password"],["id","password","type","password","pInputText","","formControlName","password","required","","spellcheck","false",3,"ngClass"],["for","confirm_password"],["id","confirm_password","type","password","pInputText","","formControlName","confirm_password","required","","spellcheck","false",3,"ngClass"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success",3,"click","loading"]],template:function(s,n){if(s&1){let c=b();o(0,"div",3)(1,"div",4)(2,"p-toolbar",5),w(3,Re,7,1,"ng-template",6)(4,Le,2,2,"ng-template",7),i(),o(5,"p-table",8,0),f("onRowSelect",function(y){return u(c),_(n.selectUser(y))})("onRowUnselect",function(){return u(c),_(n.unselectUser())}),w(7,Oe,22,0,"ng-template",9)(8,Ke,19,10,"ng-template",10)(9,Ye,3,0,"ng-template",11),i()()(),o(10,"p-dialog",12),G("visibleChange",function(y){return u(c),A(n.userDialogVisible,y)||(n.userDialogVisible=y),_(y)}),f("onHide",function(){return u(c),_(n.resetDialog())}),w(11,Ze,39,16,"ng-template",13)(12,et,2,1,"ng-template",14),i(),a(13,"p-toast",15)(14,"p-confirmDialog",15)}s&2&&(r(5),p("value",n.users())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",x(16,Me))("alwaysShowPaginator",!1)("globalFilterFields",x(17,Ne))("filterDelay",0)("loading",n.usersLoading()),r(5),H(x(18,Te)),q("visible",n.userDialogVisible),p("modal",!0)("breakpoints",x(19,Ie)),r(4),H(x(20,Te)))},dependencies:[W,z,te,X,Z,ee,se,ie,oe,ve,K,we,ae,me,be,de,Ee,Se,ue,fe]})}}return t})();var tt=[{path:"",component:He}],ke=(()=>{class t{static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275mod=V({type:t})}static{this.\u0275inj=E({imports:[D.forChild(tt),D]})}}return t})();var $t=(()=>{class t{static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275mod=V({type:t})}static{this.\u0275inj=E({providers:[T],imports:[Q,re,le,ke,Ce,pe,xe,ce,Ve,ye,_e,ge,he,Ue]})}}return t})();export{$t as UsersModule};
