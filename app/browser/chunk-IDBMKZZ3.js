import{a as Ze}from"./chunk-SXZOMBIH.js";import{d as ut,e as Xe}from"./chunk-FEXKXN77.js";import{a as gt,b as $e}from"./chunk-SE472FFV.js";import{a as te,b as Ge}from"./chunk-UCUUKJUF.js";import{a as st,b as ft,c as vt}from"./chunk-PY3BDVY3.js";import{a as be}from"./chunk-2NI67QZK.js";import{a as Je,c as St}from"./chunk-6KTFL72S.js";import{a as xe}from"./chunk-OTNHRQC2.js";import{a as Ue,b as yt,d as Se}from"./chunk-BHKLA34P.js";import{a as ie}from"./chunk-N4OSQ2YP.js";import"./chunk-LH4OTLL6.js";import"./chunk-UHFQUA5D.js";import{a as Oe}from"./chunk-7THMIGUD.js";import{a as le}from"./chunk-2SXB7SA4.js";import{a as A}from"./chunk-HY5F37U4.js";import{a as at}from"./chunk-6AMBXUQL.js";import"./chunk-YW57MKXO.js";import{b as xt,d as wt}from"./chunk-KOQJVLQP.js";import{a as Ke}from"./chunk-AXFNK55X.js";import{a as Ct,b as Qe}from"./chunk-6OAFLMEG.js";import{a as ye}from"./chunk-ZAOG6SVK.js";import{b as Ae}from"./chunk-TAW6AXMG.js";import"./chunk-3TMRKM3A.js";import{b as Le,c as ht,f as N,k as je,l as ze,q as Ye}from"./chunk-V5RHMPQH.js";import{b as bt}from"./chunk-BHJDGOJF.js";import"./chunk-LQTJ6KB6.js";import"./chunk-OVJQWTCG.js";import"./chunk-ZZBHPNZI.js";import{a as k,b as Be}from"./chunk-H6U4N3TG.js";import{i as L,j as We,m as R,n as qe}from"./chunk-LH73PZKM.js";import{$b as Fe,A as h,Aa as E,Ba as T,Da as ct,E as fe,Ea as I,Fa as U,Fc as ee,Ga as oe,Gc as _t,Ha as pt,Hb as M,Kb as j,Lb as ae,N as s,Na as C,Nb as z,Oa as b,Rb as H,Sb as K,Tb as se,U as P,Va as Ve,Vb as F,Wb as Ce,X as y,Xa as ve,Xb as J,Yb as X,Z as c,Za as Q,Zb as Z,_b as mt,a as $,aa as G,ac as ke,bb as V,bc as dt,ca as lt,cb as Me,d as ge,da as n,ea as o,eb as re,fa as v,ja as S,ka as u,kc as W,la as p,lc as B,mc as Re,nc as Y,o as ne,oa as Pe,oc as Ne,p as Te,s as d,t as D,tb as rt,u as Ie,va as l,wa as g,xa as x,y as De,yb as He,z as _,za as w}from"./chunk-4RWQR7BF.js";import{g as ot}from"./chunk-WWX6BADO.js";var Et=(()=>{class i{constructor(){this.http=d(re),this.api=d(ae),this.notificationService=d(j),this.whatsappLoading=P(!1)}sendMessage(e){this.whatsappLoading.set(!0),this.http.post(`${this.api.host}/send-whatsapp`,e).subscribe({next:r=>{this.notificationService.showInfo(r.message,"home",!1),this.whatsappLoading.set(!1)},error:r=>{this.whatsappLoading.set(!1),this.notificationService.showError("Error sending whatsapp!","home")}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ne({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Tt=(()=>{class i{constructor(){this.apiService=d(ae),this.http=d(re),this.notificationService=d(j),this.customersService=d(le),this.cashBalanceService=d(Oe),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new ge(""),this.selectedCustomerLatestItems=new ge([])}chcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getAccountTotalBalance(e.customer_id),this.cashBalanceService.getBalance()}})}returnCheckout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getAccountTotalBalance(e.customer_id),this.cashBalanceService.getBalance()}})}deleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${t}`).subscribe({next:a=>{this.notificationService.showSuccess(a.message,"home")},error:a=>{this.notificationService.handleError(a.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getAccountTotalBalance(e.customer_id),this.cashBalanceService.getBalance()}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:a=>{this.notificationService.showSuccess(a.message,"home")},error:a=>{this.notificationService.handleError(a.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getAccountTotalBalance(e.customer_id),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ne({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Dt=ot(at());var Gt=()=>({width:"95vw",height:"75vh"}),Ut=()=>({standalone:!0}),Qt=i=>({"md:col-offset-3":i}),It=i=>({invalid:i}),Kt=(i,m)=>({"text-red-500":i,"text-orange-500":m}),Jt=i=>({"text-red-500":i});function Xt(i,m){if(i&1){let e=S();n(0,"div",9)(1,"div",11)(2,"label",26),l(3,"Notes"),o(),n(4,"input",27,2),T("ngModelChange",function(t){_(e);let a=p(2);return E(a.journal_notes,t)||(a.journal_notes=t),h(t)}),o()()()}if(i&2){let e=p(2);s(4),w("ngModel",e.journal_notes)}}function Zt(i,m){i&1&&(n(0,"tr")(1,"th",28),l(2,"Barcode"),o(),n(3,"th",29),l(4,"Description"),o(),n(5,"th",30),l(6,"Unit"),o(),n(7,"th",31),l(8,"Qty"),o(),n(9,"th",30),l(10,"Total"),o(),n(11,"th",31),l(12,"Del?"),o()())}function ei(i,m){if(i&1){let e=S();n(0,"p-inputNumber",38),T("ngModelChange",function(t){_(e);let a=p().$implicit;return E(a.unit_price,t)||(a.unit_price=t),h(t)}),u("ngModelChange",function(){_(e);let t=p().$implicit,a=p(2);return h(a.setPrice(t))})("onFocus",function(t){_(e);let a=p(3);return h(a.select(t.target))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.unit_price),c("maxFractionDigits",2)("min",0)}}function ti(i,m){i&1&&v(0,"i",41)}function ii(i,m){if(i&1&&(n(0,"span",39),l(1),C(2,"currency"),n(3,"span"),y(4,ti,1,0,"i",40),o()()),i&2){let e=p().$implicit,r=p(2);c("ngClass",oe(5,Kt,!e.unit_price,r.getPriceWarining(e))),s(),g(b(2,3,e.unit_price)),s(3),c("ngIf",r.getPriceWarining(e))}}function ni(i,m){if(i&1){let e=S();n(0,"p-inputNumber",42),T("ngModelChange",function(t){_(e);let a=p().$implicit;return E(a.quantity,t)||(a.quantity=t),h(t)}),u("onFocus",function(t){_(e);let a=p(3);return h(a.select(t.target))})("ngModelChange",function(){_(e);let t=p().$implicit,a=p(2);return h(a.setQty(t))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.quantity)}}function oi(i,m){if(i&1&&(n(0,"span",39),l(1),o()),i&2){let e=p().$implicit;c("ngClass",U(2,Jt,!e.quantity)),s(),g(e.quantity)}}function ri(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td",32)(6,"p-cellEditor"),y(7,ei,1,3,"ng-template",33)(8,ii,5,8,"ng-template",34),o()(),n(9,"td",35)(10,"p-cellEditor"),y(11,ni,1,1,"ng-template",33)(12,oi,2,4,"ng-template",34),o()(),n(13,"td"),l(14),C(15,"currency"),o(),n(16,"td",36),u("click",function(){let t=_(e).rowIndex,a=p(2);return h(a.removeRow(t))}),v(17,"i",37),o()()}if(i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(),c("pEditableColumn",e.unit_price)("ngClass",U(9,It,!e.unit_price)),s(4),c("pEditableColumn",e.quantity)("ngClass",U(11,It,!e.quantity)),s(5),x(" ",b(15,7,e.unit_price*e.quantity)," ")}}function ai(i,m){if(i&1&&(n(0,"h4",44),l(1),o()),i&2){let e=p(3);s(),x(" Total units: ",e.invoiceTotal.total_qty," ")}}function si(i,m){i&1&&y(0,ai,2,1,"ng-template",43)}function li(i,m){i&1&&(n(0,"tr",45)(1,"td",46),l(2,"No data yet!"),o()())}function ci(i,m){if(i&1){let e=S();n(0,"p-card",7)(1,"div",8)(2,"div",9)(3,"div",10),v(4,"div",11),n(5,"label"),l(6,"Invoice Date"),o(),n(7,"p-calendar",12),T("ngModelChange",function(t){_(e);let a=p();return E(a.invoice_date,t)||(a.invoice_date=t),h(t)}),o()()(),n(8,"div",9)(9,"div",11)(10,"label",13),l(11,"Customer"),o(),n(12,"p-dropdown",14),T("ngModelChange",function(t){_(e);let a=p();return E(a.customer_id,t)||(a.customer_id=t),h(t)}),u("onChange",function(t){_(e);let a=p();return h(a.customerChange(t.value))}),o()()(),y(13,Xt,6,1,"div",9),n(14,"div",15)(15,"h3",16),l(16),C(17,"currency"),o(),n(18,"h3",17),l(19),C(20,"lira"),o()()(),n(21,"div",8)(22,"div",18)(23,"p-table",19,0),y(25,Zt,13,0,"ng-template",20)(26,ri,18,13,"ng-template",4)(27,si,1,0,null,21)(28,li,3,0,"ng-template",22),o()(),n(29,"div",23)(30,"p-autoComplete",24,1),T("ngModelChange",function(t){_(e);let a=p();return E(a.search_product,t)||(a.search_product=t),h(t)}),u("completeMethod",function(t){_(e);let a=p();return h(a.searchItem(t))})("onKeyUp",function(t){_(e);let a=p();return h(a.submitInvoiceInput(t))}),o(),n(32,"button",25),u("click",function(){_(e);let t=p();return h(t.openProductsDialog())}),o()()()()}if(i&2){let e=p();s(7),w("ngModel",e.invoice_date),c("ngModelOptions",I(26,Ut))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),s(5),w("ngModel",e.customer_id),c("options",e.customers)("filter",!0)("showClear",!0),s(),lt(e.customer_id?13:-1),s(),c("ngClass",U(27,Qt,!e.customer_id)),s(2),x(" USD: ",b(17,22,e.invoiceTotal.total_dollar)," "),s(3),x(" LBP: ",b(20,24,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),s(4),Pe("scrollHeight",e.vh),c("value",e.order_items)("scrollable",!0),s(4),c("ngIf",e.invoiceTotal.total_qty),s(3),w("ngModel",e.search_product),c("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function pi(i,m){if(i&1){let e=S();n(0,"p-button",50),u("click",function(){_(e);let t=p(2);return h(t.deleteInvoice())}),o()}if(i&2){let e=p(2);c("disabled",e.submitted())}}function mi(i,m){if(i&1){let e=S();y(0,pi,1,1,"p-button",47),n(1,"p-button",48),u("click",function(){_(e);let t=p();return h(t.closeEditDialog())}),o(),n(2,"p-button",49),u("click",function(){_(e);let t=p();return h(t.submitEditInvoice())}),o()}if(i&2){let e=p();c("ngIf",e.userPermissions().delete_invoice),s(),c("disabled",e.submitted()),s(),c("loading",e.submitted())("disabled",e.order_items.length==0)}}var tt=(()=>{class i{constructor(){this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new fe,this.onHide=new fe,this.stockService=d(Ae),this.editInvoiceService=d(Tt),this.authService=d(ye),this.confirmationService=d(He),this.notificationsService=d(j),this.sellService=d(vt),this.userPermissions=this.authService.userPermissions,this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new st,this.order_items=[],this.customer_id=null,this.invoice_number="",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.journal_notes=null,this.productsDialogVisible=!1,this.subscriptions=new $,this.products=this.stockService.products,this.matching_products=[],this.priceTypes=Object.keys(ft),this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(e=>{this.selectedCustomerLatestItems=e})),this.subscriptions.add(this.sellService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.sellService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=(0,Dt.default)(this.invoice.order_date).format("YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.journal_notes=this.invoice.journal_notes,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.customerChange(this.invoice.customer_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.order_items.find(r=>!r.unit_price||!r.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let r=this.order_items.find(t=>t.product_id===e.product_id);r?(r.quantity+=1,this.calculateTotal("edit")):(this.order_items.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:e.unit_cost_usd,unit_price:e.unit_price_usd,avg_cost:e.avg_cost_usd,quantity:1,stock_management:e.stock_management}),this.calculateTotal("add"))}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.sellService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let r=-1,t=["*","+"];for(let O=0;O<t.length;O++)if(e.indexOf(t[O])!==-1){r=e.indexOf(t[O]);break}let a=e.substring(0,r)||1,f=parseInt(e.substring(r+1,e.length));r!=-1&&r!=0?(this.sellService.factor.set(parseInt(a)),this.sellService.submitBarcode(f)):this.sellService.submitBarcode(e)}}calculateTotal(e){let r=new st,t=this.order_items;return t.length>0&&(t.forEach(a=>{r.total_qty+=a.quantity,r.cost_dollar+=a.unit_cost*a.quantity,r.subtotal_dollar+=a.unit_price*a.quantity}),r.total_dollar=r.subtotal_dollar-r.discount_dollar),this.invoiceTotal=r,r}submitEditInvoice(){let e=this.validateItems();e?e&&this.notificationsService.showError("Please enter price for all items","home"):this.return_invoice_edit?this.editInvoiceService.returnCheckout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number,journal_notes:this.journal_notes},this.stockService):this.editInvoiceService.chcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number,journal_notes:this.journal_notes},this.stockService)}searchItem(e){let r=this.products(),t=[],a=e.query;for(let f=0;f<r.length;f++){let O=r[f];O.product_name.toLowerCase().indexOf(a.toLowerCase())>-1&&t.push(O)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(e){}removeRow(e){this.order_items.splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(this.userPermissions().show_cost){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}else return!1}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[De],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["notes_input",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","customer"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear"],[1,"col-12","md:col-3","text-center",3,"ngClass"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],[4,"ngIf"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["for","currency"],["pInputText","","type","text","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","ngModel"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","priceEditable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["pTemplate","summary"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","class","w-full mt-4 md:w-auto md:mt-0",3,"disabled","click",4,"ngIf"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["size","small","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"]],template:function(r,t){r&1&&(n(0,"p-dialog",3),T("visibleChange",function(f){return E(t.visible,f)||(t.visible=f),f}),u("onHide",function(){return t.closeEditDialog()}),y(1,ci,33,29,"ng-template",4)(2,mi,3,4,"ng-template",5),o(),n(3,"products-dialog",6),u("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),o()),r&2&&(G(I(8,Gt)),w("visible",t.visible),c("modal",!0)("closable",!0)("maximizable",!0),s(3),c("visible",t.productsDialogVisible)("products",t.products))},dependencies:[ve,Q,z,H,Ce,Se,N,M,je,ze,W,B,k,ee,Y,L,R,Le,Ue,V,Ke],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:40px;height:28px}.priceEditable[_ngcontent-%COMP%]{width:60px;height:28px;text-align:center}[_nghost-%COMP%]  .p-inputnumber-input{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]})}}return i})();var di=()=>[10,25,50],ui=()=>({width:"95vw"});function _i(i,m){i&1&&(n(0,"tr")(1,"th"),l(2,"Invoice #"),o(),n(3,"th"),l(4,"Customer"),o(),n(5,"th"),l(6,"Datetime"),o(),n(7,"th"),l(8,"total"),o(),n(9,"th",21),l(10,"Options"),o()())}function hi(i,m){if(i&1){let e=S();n(0,"p-button",25),u("onClick",function(){_(e);let t=p().$implicit,a=p();return h(a.openEditDialog(t))}),o()}}function gi(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),C(9,"currency"),o(),n(10,"td")(11,"p-button",22),u("onClick",function(){let t=_(e).$implicit,a=p();return h(a.showInvoiceDialog(t))}),o()(),n(12,"td")(13,"p-button",23),u("onClick",function(){let t=_(e).$implicit,a=p();return h(a.printInvoice(t))}),o()(),n(14,"td"),y(15,hi,1,0,"p-button",24),o()()}if(i&2){let e=m.$implicit,r=p();s(2),g(e.invoice_number),s(2),g(e.customer_name||"---"),s(2),g(e.order_date),s(2),g(b(9,5,e.total_amount)),s(7),c("ngIf",r.userPermissions().edit_invoice)}}function fi(i,m){i&1&&(n(0,"tr")(1,"td",26),l(2,"No Records Found!"),o()())}function vi(i,m){i&1&&(n(0,"tr")(1,"th",29),l(2,"Barcode"),o(),n(3,"th",30),l(4,"Description"),o(),n(5,"th"),l(6,"Unit Price"),o(),n(7,"th",31),l(8,"Qty"),o(),n(9,"th"),l(10,"Total Price"),o()())}function yi(i,m){if(i&1&&(n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),C(7,"currency"),o(),n(8,"td"),l(9),o(),n(10,"td"),l(11),C(12,"currency"),o()()),i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(2),x(" ",b(7,5,e.unit_price)," "),s(3),g(e.quantity),s(2),x(" ",b(12,7,e.total_price)," ")}}function Ci(i,m){if(i&1&&(n(0,"tr"),v(1,"td")(2,"td")(3,"td"),n(4,"td"),l(5),o(),n(6,"td"),l(7),C(8,"currency"),o()()),i&2){let e=p(3);s(5),g(e.selectedInvoiceTotals.totalQty),s(2),x(" ",b(8,2,e.selectedInvoiceTotals.totalPrice)," ")}}function bi(i,m){if(i&1&&(n(0,"p-table",28),y(1,vi,11,0,"ng-template",14)(2,yi,13,9,"ng-template",15)(3,Ci,9,4,"ng-template",19),o()),i&2){let e=p(2);c("value",e.invoiceItems)}}function Si(i,m){if(i&1&&y(0,bi,4,1,"p-table",27),i&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function xi(i,m){if(i&1){let e=S();n(0,"button",32),u("click",function(){_(e);let t=p();return h(t.hideInvoiceDialog())}),o()}}var Vt=(()=>{class i{constructor(){this.customerService=d(le),this.historyService=d(ie),this.decimalService=d(be),this.printService=d(Xe),this.authService=d(ye),this.whatsappService=d(Et),this.dateService=d(A),this.fb=d(Fe),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.searchForm=this.fb.group({invoice_number:[null],customer_id:[null],selected_dates:[null]}),this.submitSearch()}submitSearch(){this.searchForm.value.selected_dates&&(this.searchForm.value.selected_dates=[this.dateService.formatDate(this.searchForm.value.selected_dates[0]),this.dateService.formatDate(this.searchForm.value.selected_dates[1])]),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchSalesHistory(this.searchForm.value)}printInvoice(e){this.printService.print(e,"sale")}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-sell-history"]],decls:29,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","selected_dates","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start - End dates","selectionMode","range",3,"showIcon","showClear","readonlyInput","showButtonBar"],[1,"col-12","md:col-6","lg:col-2","flex","align-items-end"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["colspan","3","width","10%"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","35%"],["width","5%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5)(7,"label"),l(8,"Invoice #:"),o(),v(9,"input",6),o(),n(10,"div",7)(11,"label"),l(12,"Customer:"),o(),v(13,"p-dropdown",8),o(),n(14,"div",5)(15,"label"),l(16,"Date Range:"),o(),v(17,"p-calendar",9),o(),n(18,"div",10),v(19,"p-button",11),n(20,"p-button",12),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(21,"p-table",13),y(22,_i,11,0,"ng-template",14)(23,gi,16,7,"ng-template",15)(24,fi,3,0,"ng-template",16),o()()()(),n(25,"p-dialog",17),T("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),u("onHide",function(){return t.hideInvoiceDialog()}),y(26,Si,1,1,"ng-template",18)(27,xi,1,0,"ng-template",19),o(),n(28,"edit-invoice",20),u("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),o()),r&2&&(s(3),c("toggleable",!0),s(),c("formGroup",t.searchForm),s(9),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(4),c("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),s(2),c("loading",t.loading()),s(),c("disabled",t.loading()),s(),c("value",t.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(28,di))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),G(I(29,ui)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),s(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers()))},dependencies:[Q,J,z,H,K,X,Z,N,M,W,B,k,ee,Y,L,R,te,tt,V],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding-bottom:0!important}"]})}}return i})();var wi=()=>[10,25,50];function Ei(i,m){i&1&&(n(0,"tr")(1,"th"),l(2,"Payment #"),o(),n(3,"th"),l(4,"Customer"),o(),n(5,"th"),l(6,"Datetime"),o(),n(7,"th"),l(8,"total"),o(),n(9,"th",16),l(10,"Options"),o()())}function Ti(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),C(9,"currency"),o(),n(10,"td"),v(11,"button",17),o(),n(12,"td")(13,"button",18),u("click",function(){let t=_(e).$implicit,a=p();return h(a.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.journal_number),s(2),g(e.partner_name),s(2),g(e.payment_date),s(2),g(b(9,4,e.total_value))}}function Ii(i,m){i&1&&(n(0,"tr")(1,"td",19),l(2,"No Records Found!"),o()())}var Mt=(()=>{class i{constructor(){this.customerService=d(le),this.historyService=d(ie),this.paymentService=d(gt),this.dateService=d(A),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({payment_date:new F(null),partner_id:new F(null),payment_number:new F(null)}),Ve(()=>{this.paymentService.onSubmit()&&this.submitSearch()}),this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&this.searchForm.patchValue({payment_date:this.dateService.formatDate(this.searchForm.value.payment_date,"YYYY-MM-DD")}),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){e&&this.historyService.fetchPaymentHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"input",6),o(),n(8,"div",5),v(9,"p-dropdown",7),o(),n(10,"div",5),v(11,"p-calendar",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),y(16,Ei,11,0,"ng-template",12)(17,Ti,14,6,"ng-template",13)(18,Ii,3,0,"ng-template",14),o()()()(),n(19,"payment-dialog",15),u("onClose",function(){return t.hidePaymentDialog()})("onSubmit",function(f){return t.getPaymentDilogResult(f)}),o()),r&2&&(s(3),c("toggleable",!0),s(),c("formGroup",t.searchForm),s(5),c("options",t.customers())("loading",t.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),s(2),c("loading",t.loading()),s(),c("disabled",t.loading()),s(),c("value",t.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(22,wi))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),c("visible",t.editDialogVisible)("selected_payment",t.selectedPayment)("accounts",t.customers()))},dependencies:[J,z,H,K,X,Z,N,M,W,B,k,Y,L,R,te,$e,V]})}}return i})();var Ht=ot(at());var Di=()=>[10,25,50],Pi=()=>({width:"95vw"});function Vi(i,m){i&1&&(n(0,"tr")(1,"th"),l(2,"Invoice #"),o(),n(3,"th"),l(4,"Customer"),o(),n(5,"th"),l(6,"Datetime"),o(),n(7,"th"),l(8,"total"),o(),n(9,"th",19),l(10,"Options"),o()())}function Mi(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),C(9,"currency"),o(),n(10,"td")(11,"button",20),u("click",function(){let t=_(e).$implicit,a=p();return h(a.showInvoiceDialog(t))}),o()(),n(12,"td")(13,"button",21),u("click",function(){let t=_(e).$implicit,a=p();return h(a.printInvoice(t))}),o()(),n(14,"td")(15,"button",22),u("click",function(){let t=_(e).$implicit,a=p();return h(a.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.invoice_number),s(2),g(e.customer_name),s(2),g(e.order_date),s(2),g(b(9,4,e.total_amount))}}function Hi(i,m){i&1&&(n(0,"tr")(1,"td",23),l(2,"No Records Found!"),o()())}function Fi(i,m){i&1&&(n(0,"tr")(1,"th",26),l(2,"Description"),o(),n(3,"th",27),l(4,"Unit Price"),o(),n(5,"th",28),l(6,"Qty"),o(),n(7,"th",27),l(8,"Total Price"),o()())}function ki(i,m){if(i&1&&(n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),C(5,"currency"),o(),n(6,"td"),l(7),o(),n(8,"td"),l(9),C(10,"currency"),o()()),i&2){let e=m.$implicit;s(2),g(e.product_name),s(2),x(" ",b(5,4,e.unit_price)," "),s(3),g(e.quantity),s(2),x(" ",b(10,6,e.total_price)," ")}}function Bi(i,m){if(i&1&&(n(0,"tr"),v(1,"td")(2,"td"),n(3,"td"),l(4),o(),n(5,"td"),l(6),C(7,"currency"),o()()),i&2){let e=p(3);s(4),g(e.selectedInvoiceTotals.totalQty),s(2),x(" Total: ",b(7,2,e.selectedInvoiceTotals.totalPrice)," ")}}function Ri(i,m){if(i&1&&(n(0,"p-table",25),y(1,Fi,9,0,"ng-template",12)(2,ki,11,8,"ng-template",13)(3,Bi,8,4,"ng-template",17),o()),i&2){let e=p(2);c("value",e.invoiceItems)}}function Ni(i,m){if(i&1&&y(0,Ri,4,1,"p-table",24),i&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function Oi(i,m){if(i&1){let e=S();n(0,"button",29),u("click",function(){_(e);let t=p();return h(t.hideInvoiceDialog())}),o()}}var Ft=(()=>{class i{constructor(){this.customerService=d(le),this.historyService=d(ie),this.decimalService=d(be),this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new $,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({invoice_number:new F(null),customer_id:new F(null),invoice_date:new F(null)})}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Ht.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){console.log(e),this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchReturnHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"p-dropdown",6),o(),n(8,"div",5),v(9,"p-calendar",7),o(),n(10,"div",5),v(11,"input",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),y(16,Vi,11,0,"ng-template",12)(17,Mi,16,6,"ng-template",13)(18,Hi,3,0,"ng-template",14),o()()()(),n(19,"p-dialog",15),T("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),u("onHide",function(){return t.hideInvoiceDialog()}),y(20,Ni,1,1,"ng-template",16)(21,Oi,1,0,"ng-template",17),o(),n(22,"edit-invoice",18),u("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),o()),r&2&&(s(3),c("toggleable",!0),s(),c("formGroup",t.searchForm),s(3),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),s(4),c("loading",t.loading()),s(),c("disabled",t.loading()),s(),c("value",t.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(28,Di))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),G(I(29,Pi)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),s(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers())("return_invoice_edit",!0))},dependencies:[Q,J,z,H,K,X,Z,N,M,W,B,k,ee,Y,L,R,te,tt,V]})}}return i})();var Nt=ot(at());var kt=(()=>{class i{constructor(){this.apiService=d(ae),this.http=d(re),this.notificationService=d(j),this.suppliersService=d(xe),this.cashBalanceService=d(Oe),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new ge(""),this.selectedSupplierLatestItems=new ge([])}chcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/supply`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnCheckout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}deleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/supply/${t}`).subscribe({next:a=>{this.notificationService.showSuccess(a.message,"home")},error:a=>{this.notificationService.handleError(a.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:a=>{this.notificationService.showSuccess(a.message,"home")},error:a=>{this.notificationService.handleError(a.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ne({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Wi=()=>({width:"95vw",height:"75vh"}),Li=()=>({standalone:!0}),qi=i=>({"ng-invalid ng-dirty":i}),Bt=i=>({invalid:i}),ji=(i,m)=>({"text-red-500":i,"text-orange-500":m}),zi=i=>({"text-red-500":i});function Yi(i,m){i&1&&(n(0,"small",27),l(1,"Supplier is required."),o())}function Ai(i,m){i&1&&(n(0,"tr")(1,"th",28),l(2,"Barcode"),o(),n(3,"th",29),l(4,"Description"),o(),n(5,"th",30),l(6,"Unit"),o(),n(7,"th",31),l(8,"Qty"),o(),n(9,"th",30),l(10,"Total"),o(),n(11,"th",31),l(12,"Del?"),o()())}function $i(i,m){if(i&1){let e=S();n(0,"p-inputNumber",38),T("ngModelChange",function(t){_(e);let a=p().$implicit;return E(a.unit_price,t)||(a.unit_price=t),h(t)}),u("ngModelChange",function(){_(e);let t=p().$implicit,a=p(2);return h(a.setPrice(t))})("onFocus",function(t){_(e);let a=p(3);return h(a.select(t.target))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.unit_price),c("maxFractionDigits",2)("min",0)}}function Gi(i,m){i&1&&v(0,"i",41)}function Ui(i,m){if(i&1&&(n(0,"span",39),l(1),C(2,"currency"),n(3,"span"),y(4,Gi,1,0,"i",40),o()()),i&2){let e=p().$implicit,r=p(2);c("ngClass",oe(5,ji,!e.unit_price,r.getPriceWarining(e))),s(),g(b(2,3,e.unit_price)),s(3),c("ngIf",r.getPriceWarining(e))}}function Qi(i,m){if(i&1){let e=S();n(0,"p-inputNumber",42),T("ngModelChange",function(t){_(e);let a=p().$implicit;return E(a.quantity,t)||(a.quantity=t),h(t)}),u("onFocus",function(t){_(e);let a=p(3);return h(a.select(t.target))})("ngModelChange",function(){_(e);let t=p().$implicit,a=p(2);return h(a.setQty(t))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.quantity)}}function Ki(i,m){if(i&1&&(n(0,"span",39),l(1),o()),i&2){let e=p().$implicit;c("ngClass",U(2,zi,!e.quantity)),s(),g(e.quantity)}}function Ji(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td",32)(6,"p-cellEditor"),y(7,$i,1,3,"ng-template",33)(8,Ui,5,8,"ng-template",34),o()(),n(9,"td",35)(10,"p-cellEditor"),y(11,Qi,1,1,"ng-template",33)(12,Ki,2,4,"ng-template",34),o()(),n(13,"td"),l(14),C(15,"currency"),o(),n(16,"td",36),u("click",function(){let t=_(e).rowIndex,a=p(2);return h(a.removeRow(t))}),v(17,"i",37),o()()}if(i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(),c("pEditableColumn",e.unit_price)("ngClass",U(9,Bt,!e.unit_price)),s(4),c("pEditableColumn",e.quantity)("ngClass",U(11,Bt,!e.quantity)),s(5),x(" ",b(15,7,e.unit_price*e.quantity)," ")}}function Xi(i,m){if(i&1&&(n(0,"h4",44),l(1),o()),i&2){let e=p(3);s(),x(" Total units: ",e.invoiceTotal.total_qty," ")}}function Zi(i,m){if(i&1&&y(0,Xi,2,1,"h4",43),i&2){let e=p(2);c("ngIf",e.invoiceTotal.total_qty)}}function en(i,m){i&1&&(n(0,"tr",45)(1,"td",46),l(2,"No data yet!"),o()())}function tn(i,m){if(i&1){let e=S();n(0,"p-card",6)(1,"div",7)(2,"div",8)(3,"div",9),v(4,"div",10),n(5,"label"),l(6,"Invoice Date"),o(),n(7,"p-calendar",11),T("ngModelChange",function(t){_(e);let a=p();return E(a.invoice_date,t)||(a.invoice_date=t),h(t)}),o()()(),n(8,"div",8)(9,"div",10)(10,"label",12),l(11,"Supplier"),n(12,"span",13),l(13," *"),o()(),n(14,"p-dropdown",14),T("ngModelChange",function(t){_(e);let a=p();return E(a.supplier_id,t)||(a.supplier_id=t),h(t)}),u("onChange",function(t){_(e);let a=p();return h(a.supplierChange(t.value))}),o(),y(15,Yi,2,0,"small",15),o()(),n(16,"div",16)(17,"h3",17),l(18),C(19,"currency"),o(),n(20,"h3",18),l(21),C(22,"lira"),o()()(),n(23,"div",7)(24,"div",19)(25,"p-table",20,0),y(27,Ai,13,0,"ng-template",21)(28,Ji,18,13,"ng-template",3)(29,Zi,1,1,"ng-template",22)(30,en,3,0,"ng-template",23),o()(),n(31,"div",24)(32,"p-autoComplete",25,1),T("ngModelChange",function(t){_(e);let a=p();return E(a.search_product,t)||(a.search_product=t),h(t)}),u("completeMethod",function(t){_(e);let a=p();return h(a.searchItem(t))})("onKeyUp",function(t){_(e);let a=p();return h(a.submitInvoiceInput(t))}),o(),n(34,"button",26),u("click",function(){_(e);let t=p();return h(t.openProductsDialog())}),o()()()()}if(i&2){let e=p();s(7),w("ngModel",e.invoice_date),c("ngModelOptions",I(25,Li))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),s(7),w("ngModel",e.supplier_id),c("options",e.suppliers)("filter",!0)("showClear",!0)("ngClass",U(26,qi,!e.supplier_id)),s(),c("ngIf",!e.supplier_id),s(3),x(" USD: ",b(19,21,e.invoiceTotal.total_dollar)," "),s(3),x(" LBP: ",b(22,23,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),s(4),Pe("scrollHeight",e.vh),c("value",e.invoice_items())("scrollable",!0),s(7),w("ngModel",e.search_product),c("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function nn(i,m){if(i&1){let e=S();n(0,"button",47),u("click",function(){_(e);let t=p();return h(t.deleteInvoice())}),o(),n(1,"button",48),u("click",function(){_(e);let t=p();return h(t.closeEditDialog())}),o(),n(2,"p-button",49),u("click",function(){_(e);let t=p();return h(t.submitEditInvoice())}),o()}if(i&2){let e=p();c("disabled",e.submitted()),s(),c("disabled",e.submitted()),s(),c("loading",e.submitted())("disabled",e.invoice_items().length==0)}}var Rt=(()=>{class i{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new fe,this.onHide=new fe,this.stockService=d(Ae),this.editInvoiceService=d(kt),this.authService=d(ye),this.confirmationService=d(He),this.notificationsService=d(j),this.supplyService=d(St),this.dateService=d(A),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Je,this.supplier_id=null,this.invoice_number="123",this.invoice_items=P([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new $,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(r=>!r.unit_price||!r.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let r=this.supplyService.factor(),t=structuredClone(this.invoice_items()),a=t.find(f=>f.product_id===e.product_id);a?a.quantity+=r:t.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:e.unit_cost_usd,unit_price:e.unit_cost_usd,quantity:r,unit_abbreviation:e.unit_abbreviation,product_unit_id:e.unit_id_fk}),this.invoice_items.set(t),this.supplyService.factor.set(1),this.calculateTotal("add")}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let r=-1,t=["*","+"];for(let O=0;O<t.length;O++)if(e.indexOf(t[O])!==-1){r=e.indexOf(t[O]);break}let a=e.substring(0,r)||1,f=parseInt(e.substring(r+1,e.length));r!=-1&&r!=0?(this.supplyService.factor.set(parseInt(a)),this.supplyService.submitBarcode(f)):this.supplyService.submitBarcode(e)}}calculateTotal(e){let r=new Je,t=this.invoice_items();return t.length>0&&(t.forEach(a=>{r.total_qty+=a.quantity,r.cost_dollar+=a.unit_cost*a.quantity,r.subtotal_dollar+=a.unit_price*a.quantity}),r.total_dollar=r.subtotal_dollar-r.discount_dollar),this.invoiceTotal=r,r}submitEditInvoice(){let e=this.validateItems();!e&&this.supplier_id?this.return_invoice_edit?this.editInvoiceService.returnCheckout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):e&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(e){let r=this.products(),t=[],a=e.query;for(let f=0;f<r.length;f++){let O=r[f];O.product_name.toLowerCase().indexOf(a.toLowerCase())>-1&&t.push(O)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(e){}removeRow(e){this.invoice_items().splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new Je}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[De],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"p-error"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash","severity","danger",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"],["pButton","","pRipple","","label","Cancel Edit","icon","pi pi-times",1,"p-button-secondary","w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["pRipple","","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"]],template:function(r,t){r&1&&(n(0,"p-dialog",2),T("visibleChange",function(f){return E(t.visible,f)||(t.visible=f),f}),u("onHide",function(){return t.closeEditDialog()}),y(1,tn,35,28,"ng-template",3)(2,nn,3,4,"ng-template",4),o(),n(3,"products-dialog",5),u("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),o()),r&2&&(G(I(8,Wi)),w("visible",t.visible),c("modal",!0)("closable",!0)("maximizable",!0),s(3),c("visible",t.productsDialogVisible)("products",t.products))},dependencies:[ve,Q,H,Ce,Se,N,M,je,ze,W,B,k,ee,L,R,Le,Ue,V,Ke],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]})}}return i})();var rn=()=>[10,25,50],an=()=>({width:"95vw"});function sn(i,m){i&1&&(n(0,"tr")(1,"th"),l(2,"Invoice #"),o(),n(3,"th"),l(4,"Supplier"),o(),n(5,"th"),l(6,"Datetime"),o(),n(7,"th"),l(8,"total"),o(),n(9,"th",19),l(10,"Options"),o()())}function ln(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),C(9,"currency"),o(),n(10,"td")(11,"button",20),u("click",function(){let t=_(e).$implicit,a=p();return h(a.showInvoiceDialog(t))}),o()(),n(12,"td")(13,"button",21),u("click",function(){let t=_(e).$implicit,a=p();return h(a.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.invoice_number),s(2),g(e.supplier_name||"---"),s(2),g(e.order_date),s(2),g(b(9,5,e.total_cost)),s(5),c("disabled",!0)}}function cn(i,m){i&1&&(n(0,"tr")(1,"td",22),l(2,"No Records Found!"),o()())}function pn(i,m){i&1&&(n(0,"tr")(1,"th",25),l(2,"Barcode"),o(),n(3,"th",26),l(4,"Description"),o(),n(5,"th",25),l(6,"Unit Price"),o(),n(7,"th",27),l(8,"Qty"),o(),n(9,"th",25),l(10,"Total Price"),o()())}function mn(i,m){if(i&1&&(n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),C(7,"currency"),o(),n(8,"td"),l(9),o(),n(10,"td"),l(11),C(12,"currency"),o()()),i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(2),x(" ",b(7,5,e.unit_cost)," "),s(3),g(e.quantity),s(2),x(" ",b(12,7,e.unit_cost*e.quantity)," ")}}function dn(i,m){if(i&1&&(n(0,"tr"),v(1,"td")(2,"td")(3,"td"),n(4,"td"),l(5),o(),n(6,"td"),l(7),C(8,"currency"),o()()),i&2){let e=p(3);s(5),g(e.selectedInvoiceTotals.totalQty),s(2),x(" ",b(8,2,e.selectedInvoiceTotals.totalCost)," ")}}function un(i,m){if(i&1&&(n(0,"p-table",24),y(1,pn,11,0,"ng-template",12)(2,mn,13,9,"ng-template",13)(3,dn,9,4,"ng-template",17),o()),i&2){let e=p(2);c("value",e.invoiceItems)}}function _n(i,m){if(i&1&&y(0,un,4,1,"p-table",23),i&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function hn(i,m){if(i&1){let e=S();n(0,"button",28),u("click",function(){_(e);let t=p();return h(t.hideInvoiceDialog())}),o()}}var Ot=(()=>{class i{constructor(){this.suppliersService=d(xe),this.historyService=d(ie),this.decimalService=d(be),this.printService=d(Xe),this.suppliers=this.suppliersService.suppliers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new $,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({invoice_number:new F(null),supplier_id:new F(null),invoice_date:new F(null)})}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Nt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{console.log(r),this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}printDelivery(e){}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(e){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(e){this.printService.print(e,"sale")}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-supply-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click","disabled"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","5%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"input",6),o(),n(8,"div",5),v(9,"p-dropdown",7),o(),n(10,"div",5),v(11,"p-calendar",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),y(16,sn,11,0,"ng-template",12)(17,ln,14,7,"ng-template",13)(18,cn,3,0,"ng-template",14),o()()()(),n(19,"p-dialog",15),T("visibleChange",function(f){return E(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),u("onHide",function(){return t.hideInvoiceDialog()}),y(20,_n,1,1,"ng-template",16)(21,hn,1,0,"ng-template",17),o(),n(22,"edit-purchase",18),u("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),o()),r&2&&(s(3),c("toggleable",!0),s(),c("formGroup",t.searchForm),s(5),c("options",t.suppliers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),s(2),c("loading",t.loading()),s(),c("disabled",t.loading()),s(),c("value",t.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(28,rn))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),G(I(29,an)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),s(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("suppliers",t.suppliers()))},dependencies:[Q,J,z,H,K,X,Z,N,M,W,B,k,ee,Y,L,R,te,Rt,V]})}}return i})();var gn=()=>[10,25,50];function fn(i,m){i&1&&(n(0,"tr")(1,"th"),l(2,"Payment #"),o(),n(3,"th"),l(4,"Supplier"),o(),n(5,"th"),l(6,"Datetime"),o(),n(7,"th"),l(8,"total"),o(),n(9,"th",16),l(10,"Options"),o()())}function vn(i,m){if(i&1){let e=S();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),C(9,"currency"),o(),n(10,"td")(11,"button",17),u("click",function(){let t=_(e).$implicit,a=p();return h(a.printInvoice(t))}),o()(),n(12,"td")(13,"button",18),u("click",function(){let t=_(e).$implicit,a=p();return h(a.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.journal_number),s(2),g(e.partner_name),s(2),g(e.payment_date),s(2),g(b(9,4,e.total_value))}}function yn(i,m){i&1&&(n(0,"tr")(1,"td",19),l(2,"No Records Found!"),o()())}var Wt=(()=>{class i{constructor(){this.suppliersService=d(xe),this.historyService=d(ie),this.dateService=d(A),this.suppliers=this.suppliersService.suppliers,this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new $,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({payment_date:new F(null),partner_id:new F(null),payment_number:new F(null)})}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=this.dateService.formatDate(this.searchForm.value.payment_date)),this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}showInvoiceDialog(e){}printInvoice(e){}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.historyService.fetchReceiptsHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-receipts-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"input",6),o(),n(8,"div",5),v(9,"p-dropdown",7),o(),n(10,"div",5),v(11,"p-calendar",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),y(16,fn,11,0,"ng-template",12)(17,vn,14,6,"ng-template",13)(18,yn,3,0,"ng-template",14),o()()()(),n(19,"supplier-payment-dialog",15),u("onClose",function(){return t.hidePaymentDialog()})("onSubmit",function(f){return t.getPaymentDilogResult(f)}),o()),r&2&&(s(3),c("toggleable",!0),s(),c("formGroup",t.searchForm),s(5),c("options",t.suppliers())("loading",t.suppliersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),s(2),c("loading",t.loading()),s(),c("disabled",t.loading()),s(),c("value",t.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(22,gn))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),c("visible",t.editDialogVisible)("selected_payment",t.selectedPayment)("accounts",t.suppliers()))},dependencies:[J,z,H,K,X,Z,N,M,W,B,k,Y,L,R,te,Ze,V]})}}return i})();var Lt=(()=>{class i{constructor(){this.api=d(ae),this.notificationService=d(j),this.http=d(re),this.dateService=d(A),this.startDate=P(this.dateService.getStartOfMonth()),this.endDate=P(this.dateService.getCurrentDate()),this.loadingTransactions=P(!1),this.cashTransactions=P([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"YYYY-MM-DD"))}getCashTransactions(e,r){this.loadingTransactions.set(!0),e=this.dateService.formatDate(e,"YYYY-MM-DD"),r=this.dateService.formatDate(r,"YYYY-MM-DD"),this.http.get(`${this.api.host()}/balance/transactions/${e}&${r}`).subscribe({next:t=>{this.cashTransactions.set(t),this.loadingTransactions.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.loadingTransactions.set(!1)}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ne({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Cn=(i,m)=>({"text-300":i,"text-green-600":m}),bn=(i,m)=>({"text-300":i,"text-red-600":m}),Sn=(i,m,e)=>({"text-red-600":i,"text-green-600":m,"font-bold":e}),xn=(i,m)=>({"text-red-600":i,"text-green-600":m});function wn(i,m){if(i&1){let e=S();n(0,"label",9),l(1,"Start Date:"),o(),n(2,"p-calendar",10),T("ngModelChange",function(t){_(e);let a=p();return E(a.startDate,t)||(a.startDate=t),h(t)}),u("onSelect",function(){_(e);let t=p();return h(t.startDateChanged())}),o()}if(i&2){let e=p();s(2),w("ngModel",e.startDate),c("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function En(i,m){if(i&1){let e=S();n(0,"label",9),l(1,"End Date:"),o(),n(2,"p-calendar",10),T("ngModelChange",function(t){_(e);let a=p();return E(a.endDate,t)||(a.endDate=t),h(t)}),u("onSelect",function(){_(e);let t=p();return h(t.endDateChanged())}),o()}if(i&2){let e=p();s(2),w("ngModel",e.endDate),c("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Tn(i,m){if(i&1){let e=S();n(0,"p-button",11),u("onClick",function(){_(e);let t=p();return h(t.selectToday())}),o(),n(1,"p-button",12),u("onClick",function(){_(e);let t=p();return h(t.selectThisMonth())}),o(),n(2,"p-button",13),u("onClick",function(){_(e);let t=p();return h(t.selectThisYear())}),o()}i&2&&(c("size","small"),s(),c("size","small"),s(),c("size","small"))}function In(i,m){i&1&&(n(0,"tr")(1,"th",14),l(2,"Date"),o(),n(3,"th",14),l(4,"Transaction"),o(),n(5,"th",15),l(6,"Description"),o(),n(7,"th",15),l(8,"Debit"),o(),n(9,"th",15),l(10,"Credit"),o(),n(11,"th",15),l(12,"Balance"),o()())}function Dn(i,m){if(i&1&&(n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td",16),l(8),C(9,"currency"),o(),n(10,"td",16),l(11),C(12,"currency"),o(),n(13,"td",16),l(14),C(15,"currency"),o()()),i&2){let e=m.$implicit,r=m.rowIndex,t=p();s(2),x(" ",e.journal_date||"Before "+t.startDate()," "),s(2),g(e.journal_number||"---"),s(2),g(e.journal_description||"---"),s(),c("ngClass",oe(15,Cn,e.debit==0,e.debit!=0)),s(),x(" ",b(9,9,e.debit)," "),s(2),c("ngClass",oe(18,bn,e.credit==0,e.credit!=0)),s(),x(" ",b(12,11,e.credit)," "),s(2),c("ngClass",pt(21,Sn,t.balances[r]<0,t.balances[r]>0,t.balances[r]==0)),s(),x(" ",b(15,13,t.balances[r])," ")}}function Pn(i,m){if(i&1&&(n(0,"tr"),v(1,"td",17),n(2,"td"),l(3,"Balance Due"),o(),n(4,"td",16),l(5),C(6,"currency"),o()()),i&2){let e=p();s(4),c("ngClass",oe(4,xn,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),s(),x(" ",b(6,2,e.balances[e.balances.length-1])," ")}}var nt=(()=>{class i{constructor(){this.transactionService=d(Lt),this.fb=d(Fe),this.dateService=d(A),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.submitSearch(),Ve(()=>{let e=this.cashTransactions();if(e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let r=1;r<e.length;r++)this.balances[r]=this.balances[r-1]+parseFloat(e[r].debit)-parseFloat(e[r].credit)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["cash-transactions"]],standalone:!0,features:[ct],decls:11,vars:2,consts:[[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","20%"],["width","15%"],[3,"ngClass"],["colspan","4"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-toolbar"),y(4,wn,3,6,"ng-template",2)(5,En,3,6,"ng-template",3)(6,Tn,3,3,"ng-template",4),o(),n(7,"p-table",5),y(8,In,13,0,"ng-template",6)(9,Dn,16,25,"ng-template",7)(10,Pn,7,7,"ng-template",8),o()()()()),r&2&&(s(7),c("value",t.cashTransactions())("scrollable",!0))},dependencies:[Be,k,M,Ge,Ne,qe,R,B,Ye,N,Re,V,We,ke,H,mt,Ce,Me,ve,Qe,Ct]})}}return i})();var qt=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-cash-history"]],decls:1,vars:0,template:function(r,t){r&1&&v(0,"cash-transactions")},dependencies:[nt]})}}return i})();var Mn=[{path:"sales-history",data:{breadcrumb:"sales"},component:Vt},{path:"payment-history",data:{breadcrumb:"payments"},component:Mt},{path:"return-history",data:{breadcrumb:"returns"},component:Ft},{path:"purchases-history",data:{breadcrumb:"purchases"},component:Ot,canActivate:[ut]},{path:"receipts-history",data:{breadcrumb:"receipts"},component:Wt},{path:"cash-history",data:{breadcrumb:"Cash"},component:qt}],jt=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=Ie({type:i})}static{this.\u0275inj=Te({imports:[rt.forChild(Mn),rt]})}}return i})();var Wa=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=Ie({type:i})}static{this.\u0275inj=Te({imports:[Me,jt,ke,dt,Se,Ye,Re,Be,_t,Ne,Qe,We,qe,Ge,xt,ht,wt,yt,bt,$e,Ze,nt]})}}return i})();export{Wa as HistoryModule};
