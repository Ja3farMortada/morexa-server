import{b as d}from"./chunk-2LVZO5F4.js";import{Gb as u,Hb as m,R as i,ab as h,c as n,jb as l,m as c,p as r}from"./chunk-D4YDXMC2.js";var x=(()=>{class a{constructor(){this.http=r(h),this.router=r(l),this.notificationService=r(u),this.userService=r(d),this.customers=i([]),this.selectedCustomer=i(null),this.customersTotalDebts$=i({id:0,balance:"0"}),this.customerDialogVisible=i(!1),this.newOrder$=new n(null),this.customerBalance$=new n([]),this.signal_submitItemLoading=i(!1),this.signal_tableLoading=i(!1),this.signal_balanceLoading=i(!1),this.api=r(m),this.host=this.api.host,this.debts=i([]),this.debtsLoading=i(!1),this.getCustomers()}getDebts(){this.debtsLoading.set(!0),this.http.get(`${this.host()}/customers/debts`).subscribe({next:e=>{this.debts.set(e),this.debtsLoading.set(!1)},error:e=>{this.notificationService.handleError(e.error,"home"),this.debtsLoading.set(!1)}})}getCustomers(){this.signal_tableLoading.set(!0),this.http.get(`${this.host()}/customers`).subscribe({next:e=>{this.customers.set(e)},error:e=>{this.notificationService.handleError(e.error,"home"),this.signal_tableLoading.set(!1)},complete:()=>{this.signal_tableLoading.set(!1)}})}createCustomer(e){this.signal_submitItemLoading.set(!0),this.http.post(`${this.host()}/customers`,e).subscribe({next:t=>{this.notificationService.showSuccess("Customer added successfully!","home"),this.customers.set([...this.customers(),t])},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submitItemLoading.set(!1)},complete:()=>{this.customerDialogVisible.set(!1),this.signal_submitItemLoading.set(!1)}})}updateCustomer(e){this.signal_submitItemLoading.set(!0),this.http.put(`${this.host()}/customers/${e.account_id}`,e).subscribe({next:t=>{let o=this.customers().findIndex(s=>s.account_id===t.account_id);this.customers.update(s=>[...s.slice(0,o),t,...s.slice(o+1)]),this.selectedCustomer.set(t),this.notificationService.showSuccess("Data updated successfully!","home")},error:t=>{this.notificationService.showError(t,"home"),this.signal_submitItemLoading.set(!1)},complete:()=>{this.customerDialogVisible.set(!1),this.signal_submitItemLoading.set(!1)}})}deleteCustomer(e){this.http.delete(`${this.host()}/customers/${e.account_id}`).subscribe({next:t=>{this.customers.update(o=>{let s=this.customers().findIndex(g=>g.account_id===e.account_id);return o.splice(s,1),[...o]}),this.selectedCustomer.set(null),this.notificationService.showSuccess(t.message,"home")},error:t=>{this.notificationService.handleError(t.error,"home")}})}getCustomerBalance(e,t,o){this.signal_submitItemLoading.set(!0),this.http.get(`${this.host()}/customers/transactions/${e}&${t}&${o}`).subscribe({next:s=>{this.customerBalance$.next(s)},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submitItemLoading.set(!1)},complete:()=>{this.signal_submitItemLoading.set(!1)}})}getAccountTotalBalance(e){this.signal_balanceLoading.set(!0),this.http.get(`${this.host()}/customers/${e}/balance`).subscribe({next:t=>{this.customersTotalDebts$.set(t)},error:t=>{this.notificationService.handleError(t.error,"home"),this.signal_balanceLoading.set(!1)},complete:()=>{this.signal_balanceLoading.set(!1)}})}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{x as a};
