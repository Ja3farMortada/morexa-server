import{a as f}from"./chunk-7THMIGUD.js";import{a as d}from"./chunk-LQTJ6KB6.js";import{b as l}from"./chunk-ZZBHPNZI.js";import{Kb as n,Lb as c,U as s,eb as a,o as h,s as i}from"./chunk-4RWQR7BF.js";var _=(()=>{class r{constructor(){this.http=i(a),this.apiService=i(c),this.notificationService=i(n),this.cashBalanceService=i(f),this.socket=i(d),this.userService=i(l),this.salesHistory=s([]),this.paymentsHistory=s([]),this.signal_loading=s(!1),this.moneyTransfersHistory=s([]),this.returnHistory=s([]),this.selectedOrderItems=s([]),this.receiptsHistory=s([]),this.purchasesHistory=s([]),this.selectedPurchaseItems=s([]),this.socketId=this.userService.socketId,this.initializeSockets()}fetchSalesHistory(t=null){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/sales/search`,t).subscribe({next:e=>{this.salesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchOrderItemsById(t){t.length>0&&this.http.post(`${this.apiService.host()}/history/sales/details`,t).subscribe({next:e=>{this.selectedOrderItems.set(e)},error:e=>{this.notificationService.showError(e.error,"home")}})}fetchPaymentHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/payment/search`,t).subscribe({next:e=>{this.paymentsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchMoneyTransferHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/money-transfer/search`,t).subscribe({next:e=>{this.moneyTransfersHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReturnHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/return/search`,t).subscribe({next:e=>{this.returnHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchasesHistory(t=null){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/purchase/search`,t).subscribe({next:e=>{this.purchasesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchaseItemsById(t){t.length>0&&this.http.post(`${this.apiService.host()}/history/purchases/details`,t).subscribe({next:e=>{this.selectedPurchaseItems.set(e)},error:e=>{this.notificationService.showError(e.error,"home")}})}fetchReceiptsHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/receipt/search`,t).subscribe({next:e=>{this.receiptsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}initializeSockets(){this.socket.on("sellOrderCreated",t=>{let e=t[0];t[1].user_id!=this.socketId()&&(this.fetchSalesHistory(),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("New order created!","home"))}),this.socket.on("sellOrderUpdated",t=>{let e=t[0];t[1].user_id!=this.socketId()&&(this.fetchSalesHistory(),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An order has been updated!","home"))}),this.socket.on("sellOrderDeleted",t=>{let e=t[0];t[1].user_id!=this.socketId()&&(this.fetchSalesHistory(),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An order has been deleted!","home"))})}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{_ as a};
