import{a as qe}from"./chunk-OPS47VDF.js";import{d as et}from"./chunk-XFFI4HQX.js";import{a as lt,b as Be}from"./chunk-U4LVY6CY.js";import{a as K,b as ke}from"./chunk-2FZ3X7AU.js";import{a as Ne}from"./chunk-AA44EB2P.js";import{a as He}from"./chunk-IETW5CIO.js";import{a as Fe}from"./chunk-FFDJZOVM.js";import"./chunk-3OXATH4N.js";import{a as R}from"./chunk-CM4NZ263.js";import{a as We,c as _t}from"./chunk-C2LLDE4X.js";import{a as oe}from"./chunk-Q67CXJ4Z.js";import{a as Oe,b as mt,c as dt}from"./chunk-B5NN6IYX.js";import{a as Q}from"./chunk-V4YX5ONG.js";import"./chunk-ISVQSFPG.js";import{a as tt}from"./chunk-2IAGA2KS.js";import"./chunk-JHV34F2Y.js";import"./chunk-JTH5INRY.js";import{a as Mt}from"./chunk-22DMWHJU.js";import{a as ht,b as gt}from"./chunk-MGDARQZO.js";import{a as ct}from"./chunk-4ID2WBEC.js";import"./chunk-SNM2CLGW.js";import{a as ut}from"./chunk-5G6QHU5I.js";import{a as pt,b as Re}from"./chunk-R6KW2DC6.js";import{a as be}from"./chunk-DC3T4MAL.js";import{b as st}from"./chunk-MAZQTZTP.js";import"./chunk-QMM6CLJV.js";import"./chunk-2LVZO5F4.js";import"./chunk-CHNOQELU.js";import{a as F,b as Ee}from"./chunk-ZTKZ5H54.js";import{E as Ve,i as $,j as Pe,l as nt,m as ot,p as k,q as Me,t as N,y as rt,z as at}from"./chunk-CGG3ICFJ.js";import{Aa as I,B as Ye,Ba as re,Bc as ne,Ca as Z,Cc as it,Da as Je,Db as M,Gb as te,Hb as Ce,Ja as S,Jb as L,K as s,Ka as C,Nb as V,Ob as z,Pb as ie,R as O,Ra as ge,Rb as H,Sb as xe,Ta as fe,Tb as Y,U as v,Ub as j,Va as ee,Vb as A,W as p,Wb as Xe,Xb as we,Yb as Te,Z as X,Za as P,Zb as Ze,_a as ye,a as J,aa as n,ab as ve,ba as o,c as ze,ca as f,ga as b,gc as W,ha as u,hc as B,ia as c,ic as De,jc as G,kc as Ie,la as Qe,m as ue,n as _e,p as d,pb as je,q as w,r as he,ra as a,sa as g,ta as x,ub as Se,v as Ke,va as T,w as _,wa as E,x as h,xa as D,za as Ue}from"./chunk-D4YDXMC2.js";import{f as Pt}from"./chunk-TSRGIXR5.js";var Vt=()=>[10,25,50],Ht=()=>({width:"95vw"});function Ft(i,m){i&1&&(n(0,"tr")(1,"th"),a(2,"Invoice #"),o(),n(3,"th"),a(4,"Datetime"),o(),n(5,"th"),a(6,"total"),o(),n(7,"th",18),a(8,"Options"),o()())}function Bt(i,m){if(i&1){let e=b();n(0,"p-button",22),u("onClick",function(){_(e);let t=c().$implicit,l=c();return h(l.deleteInvoice(t.order_id))}),o()}if(i&2){let e=c(2);p("loading",e.loadingDelete())}}function kt(i,m){if(i&1){let e=b();n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),S(7,"currency"),o(),n(8,"td")(9,"p-button",19),u("onClick",function(){let t=_(e).$implicit,l=c();return h(l.showInvoiceDialog(t))}),o()(),n(10,"td")(11,"p-button",20),u("onClick",function(){let t=_(e).$implicit,l=c();return h(l.printInvoice(t))}),o()(),n(12,"td"),v(13,Bt,1,1,"p-button",21),o()()}if(i&2){let e=m.$implicit,r=c();s(2),g(e.invoice_number),s(2),g(e.order_date),s(2),g(C(7,4,e.total_amount)),s(7),p("ngIf",r.userPermissions().delete_invoice)}}function Nt(i,m){i&1&&(n(0,"tr")(1,"td",23),a(2,"No Records Found!"),o()())}function Rt(i,m){i&1&&(n(0,"tr")(1,"th",26),a(2,"Barcode"),o(),n(3,"th",27),a(4,"Description"),o(),n(5,"th"),a(6,"Unit Price"),o(),n(7,"th",28),a(8,"Qty"),o(),n(9,"th"),a(10,"Total Price"),o()())}function Ot(i,m){if(i&1&&(n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),S(7,"currency"),o(),n(8,"td"),a(9),o(),n(10,"td"),a(11),S(12,"currency"),o()()),i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(2),x(" ",C(7,5,e.unit_price)," "),s(3),g(e.quantity),s(2),x(" ",C(12,7,e.total_price)," ")}}function Wt(i,m){if(i&1&&(n(0,"tr"),f(1,"td")(2,"td")(3,"td"),n(4,"td"),a(5),o(),n(6,"td"),a(7),S(8,"currency"),o()()),i&2){let e=c(3);s(5),g(e.selectedInvoiceTotals.totalQty),s(2),x(" ",C(8,2,e.selectedInvoiceTotals.totalPrice)," ")}}function qt(i,m){if(i&1&&(n(0,"p-table",25),v(1,Rt,11,0,"ng-template",12)(2,Ot,13,9,"ng-template",13)(3,Wt,9,4,"ng-template",17),o()),i&2){let e=c(2);p("value",e.invoiceItems)}}function Lt(i,m){if(i&1&&v(0,qt,4,1,"p-table",24),i&2){let e=c();p("ngIf",e.invoiceItems.length!=0)}}function zt(i,m){if(i&1){let e=b();n(0,"button",29),u("click",function(){_(e);let t=c();return h(t.hideInvoiceDialog())}),o()}}var yt=(()=>{class i{constructor(){this.customerService=d(He),this.historyService=d(Q),this.decimalService=d(Fe),this.printService=d(Ne),this.authService=d(be),this.dateService=d(R),this.fb=d(we),this.confirmationService=d(Se),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.searchForm=this.fb.group({invoice_number:[null],customer_id:[null],selected_dates:[null]}),this.loadingDelete=this.historyService.loadingDelete,this.submitSearch()}submitSearch(){this.searchForm.value.selected_dates&&(this.searchForm.value.selected_dates=[this.dateService.formatDate(this.searchForm.value.selected_dates[0]),this.dateService.formatDate(this.searchForm.value.selected_dates[1])]),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchSalesHistory(this.searchForm.value)}printInvoice(e){this.printService.thermalPrint(e,"sale")}deleteInvoice(e){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.historyService.deleteInvoice(e)}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["app-sell-history"]],decls:24,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","selected_dates","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Start - End dates","selectionMode","range",3,"showIcon","showClear","readonlyInput","showButtonBar"],[1,"col-12","md:col-6","lg:col-2","flex","align-items-end"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["colspan","3","width","10%"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","icon","fas fa-trash-alt","severity","danger",3,"loading","onClick",4,"ngIf"],["size","small","icon","fas fa-trash-alt","severity","danger",3,"onClick","loading"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","35%"],["width","5%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5)(7,"label"),a(8,"Invoice #:"),o(),f(9,"input",6),o(),n(10,"div",5)(11,"label"),a(12,"Date Range:"),o(),f(13,"p-calendar",7),o(),n(14,"div",8),f(15,"p-button",9),n(16,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(17,"p-table",11),v(18,Ft,9,0,"ng-template",12)(19,kt,14,6,"ng-template",13)(20,Nt,3,0,"ng-template",14),o()()()(),n(21,"p-dialog",15),D("visibleChange",function(y){return E(t.detailsDialogVisible,y)||(t.detailsDialogVisible=y),y}),u("onHide",function(){return t.hideInvoiceDialog()}),v(22,Lt,1,1,"ng-template",16)(23,zt,1,0,"ng-template",17),o()),r&2&&(s(3),p("toggleable",!0),s(),p("formGroup",t.searchForm),s(9),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),s(2),p("loading",t.loading()),s(),p("disabled",t.loading()),s(),p("value",t.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(21,Vt))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),X(I(22,Ht)),T("visible",t.detailsDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[ee,Y,L,V,z,j,A,N,M,W,B,F,ne,G,k,K,P],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding-bottom:0!important}"]})}}return i})();var Yt=()=>[10,25,50];function jt(i,m){i&1&&(n(0,"tr")(1,"th"),a(2,"Payment #"),o(),n(3,"th"),a(4,"Customer"),o(),n(5,"th"),a(6,"Datetime"),o(),n(7,"th"),a(8,"total"),o(),n(9,"th",16),a(10,"Options"),o()())}function At(i,m){if(i&1){let e=b();n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),o(),n(7,"td"),a(8),S(9,"currency"),o(),n(10,"td"),f(11,"button",17),o(),n(12,"td")(13,"button",18),u("click",function(){let t=_(e).$implicit,l=c();return h(l.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.journal_number),s(2),g(e.partner_name),s(2),g(e.payment_date),s(2),g(C(9,4,e.total_value))}}function Gt(i,m){i&1&&(n(0,"tr")(1,"td",19),a(2,"No Records Found!"),o()())}var vt=(()=>{class i{constructor(){this.customerService=d(He),this.historyService=d(Q),this.paymentService=d(lt),this.dateService=d(R),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ie({payment_date:new H(null),partner_id:new H(null),payment_number:new H(null)}),ge(()=>{this.paymentService.onSubmit()&&this.submitSearch()}),this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&this.searchForm.patchValue({payment_date:this.dateService.formatDate(this.searchForm.value.payment_date,"YYYY-MM-DD")}),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){e&&this.historyService.fetchPaymentHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),f(7,"input",6),o(),n(8,"div",5),f(9,"p-dropdown",7),o(),n(10,"div",5),f(11,"p-calendar",8),o(),n(12,"div",5),f(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),v(16,jt,11,0,"ng-template",12)(17,At,14,6,"ng-template",13)(18,Gt,3,0,"ng-template",14),o()()()(),n(19,"payment-dialog",15),u("onClose",function(){return t.hidePaymentDialog()})("onSubmit",function(y){return t.getPaymentDilogResult(y)}),o()),r&2&&(s(3),p("toggleable",!0),s(),p("formGroup",t.searchForm),s(5),p("options",t.customers())("loading",t.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),s(2),p("loading",t.loading()),s(),p("disabled",t.loading()),s(),p("value",t.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(22,Yt))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),p("visible",t.editDialogVisible)("selected_payment",t.selectedPayment)("accounts",t.customers()))},dependencies:[Y,L,V,z,j,A,N,M,W,B,F,G,$,k,K,Be,P]})}}return i})();var xt=Pt(Mt());var St=(()=>{class i{constructor(){this.apiService=d(Ce),this.http=d(ve),this.notificationService=d(te),this.suppliersService=d(oe),this.cashBalanceService=d(tt),this.host=this.apiService.host,this.currentInvoice=O({}),this.signal_submited=O(!1),this.signal_submit_loading=O(!1),this.action_status$=new ze(""),this.selectedSupplierLatestItems=new ze([])}chcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/supply`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnCheckout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}deleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/supply/${t}`).subscribe({next:l=>{this.notificationService.showSuccess(l.message,"home")},error:l=>{this.notificationService.handleError(l.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:l=>{this.notificationService.showSuccess(l.message,"home")},error:l=>{this.notificationService.handleError(l.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ue({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var $t=()=>({width:"95vw",height:"75vh"}),Kt=()=>({standalone:!0}),Qt=i=>({"ng-invalid ng-dirty":i}),Ct=i=>({invalid:i}),Ut=(i,m)=>({"text-red-500":i,"text-orange-500":m}),Jt=i=>({"text-red-500":i});function Xt(i,m){i&1&&(n(0,"small",27),a(1,"Supplier is required."),o())}function Zt(i,m){i&1&&(n(0,"tr")(1,"th",28),a(2,"Barcode"),o(),n(3,"th",29),a(4,"Description"),o(),n(5,"th",30),a(6,"Unit"),o(),n(7,"th",31),a(8,"Qty"),o(),n(9,"th",30),a(10,"Total"),o(),n(11,"th",31),a(12,"Del?"),o()())}function ei(i,m){if(i&1){let e=b();n(0,"p-inputNumber",38),D("ngModelChange",function(t){_(e);let l=c().$implicit;return E(l.unit_price,t)||(l.unit_price=t),h(t)}),u("ngModelChange",function(){_(e);let t=c().$implicit,l=c(2);return h(l.setPrice(t))})("onFocus",function(t){_(e);let l=c(3);return h(l.select(t.target))}),o()}if(i&2){let e=c().$implicit;T("ngModel",e.unit_price),p("maxFractionDigits",2)("min",0)}}function ti(i,m){i&1&&f(0,"i",41)}function ii(i,m){if(i&1&&(n(0,"span",39),a(1),S(2,"currency"),n(3,"span"),v(4,ti,1,0,"i",40),o()()),i&2){let e=c().$implicit,r=c(2);p("ngClass",Z(5,Ut,!e.unit_price,r.getPriceWarining(e))),s(),g(C(2,3,e.unit_price)),s(3),p("ngIf",r.getPriceWarining(e))}}function ni(i,m){if(i&1){let e=b();n(0,"p-inputNumber",42),D("ngModelChange",function(t){_(e);let l=c().$implicit;return E(l.quantity,t)||(l.quantity=t),h(t)}),u("onFocus",function(t){_(e);let l=c(3);return h(l.select(t.target))})("ngModelChange",function(){_(e);let t=c().$implicit,l=c(2);return h(l.setQty(t))}),o()}if(i&2){let e=c().$implicit;T("ngModel",e.quantity)}}function oi(i,m){if(i&1&&(n(0,"span",39),a(1),o()),i&2){let e=c().$implicit;p("ngClass",re(2,Jt,!e.quantity)),s(),g(e.quantity)}}function ri(i,m){if(i&1){let e=b();n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td",32)(6,"p-cellEditor"),v(7,ei,1,3,"ng-template",33)(8,ii,5,8,"ng-template",34),o()(),n(9,"td",35)(10,"p-cellEditor"),v(11,ni,1,1,"ng-template",33)(12,oi,2,4,"ng-template",34),o()(),n(13,"td"),a(14),S(15,"currency"),o(),n(16,"td",36),u("click",function(){let t=_(e).rowIndex,l=c(2);return h(l.removeRow(t))}),f(17,"i",37),o()()}if(i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(),p("pEditableColumn",e.unit_price)("ngClass",re(9,Ct,!e.unit_price)),s(4),p("pEditableColumn",e.quantity)("ngClass",re(11,Ct,!e.quantity)),s(5),x(" ",C(15,7,e.unit_price*e.quantity)," ")}}function ai(i,m){if(i&1&&(n(0,"h4",44),a(1),o()),i&2){let e=c(3);s(),x(" Total units: ",e.invoiceTotal.total_qty," ")}}function si(i,m){if(i&1&&v(0,ai,2,1,"h4",43),i&2){let e=c(2);p("ngIf",e.invoiceTotal.total_qty)}}function li(i,m){i&1&&(n(0,"tr",45)(1,"td",46),a(2,"No data yet!"),o()())}function pi(i,m){if(i&1){let e=b();n(0,"p-card",6)(1,"div",7)(2,"div",8)(3,"div",9),f(4,"div",10),n(5,"label"),a(6,"Invoice Date"),o(),n(7,"p-calendar",11),D("ngModelChange",function(t){_(e);let l=c();return E(l.invoice_date,t)||(l.invoice_date=t),h(t)}),o()()(),n(8,"div",8)(9,"div",10)(10,"label",12),a(11,"Supplier"),n(12,"span",13),a(13," *"),o()(),n(14,"p-dropdown",14),D("ngModelChange",function(t){_(e);let l=c();return E(l.supplier_id,t)||(l.supplier_id=t),h(t)}),u("onChange",function(t){_(e);let l=c();return h(l.supplierChange(t.value))}),o(),v(15,Xt,2,0,"small",15),o()(),n(16,"div",16)(17,"h3",17),a(18),S(19,"currency"),o(),n(20,"h3",18),a(21),S(22,"lira"),o()()(),n(23,"div",7)(24,"div",19)(25,"p-table",20,0),v(27,Zt,13,0,"ng-template",21)(28,ri,18,13,"ng-template",3)(29,si,1,1,"ng-template",22)(30,li,3,0,"ng-template",23),o()(),n(31,"div",24)(32,"p-autoComplete",25,1),D("ngModelChange",function(t){_(e);let l=c();return E(l.search_product,t)||(l.search_product=t),h(t)}),u("completeMethod",function(t){_(e);let l=c();return h(l.searchItem(t))})("onKeyUp",function(t){_(e);let l=c();return h(l.submitInvoiceInput(t))}),o(),n(34,"button",26),u("click",function(){_(e);let t=c();return h(t.openProductsDialog())}),o()()()()}if(i&2){let e=c();s(7),T("ngModel",e.invoice_date),p("ngModelOptions",I(25,Kt))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),s(7),T("ngModel",e.supplier_id),p("options",e.suppliers)("filter",!0)("showClear",!0)("ngClass",re(26,Qt,!e.supplier_id)),s(),p("ngIf",!e.supplier_id),s(3),x(" USD: ",C(19,21,e.invoiceTotal.total_dollar)," "),s(3),x(" LBP: ",C(22,23,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),s(4),Qe("scrollHeight",e.vh),p("value",e.invoice_items())("scrollable",!0),s(7),T("ngModel",e.search_product),p("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function ci(i,m){if(i&1){let e=b();n(0,"button",47),u("click",function(){_(e);let t=c();return h(t.deleteInvoice())}),o(),n(1,"button",48),u("click",function(){_(e);let t=c();return h(t.closeEditDialog())}),o(),n(2,"p-button",49),u("click",function(){_(e);let t=c();return h(t.submitEditInvoice())}),o()}if(i&2){let e=c();p("disabled",e.submitted()),s(),p("disabled",e.submitted()),s(),p("loading",e.submitted())("disabled",e.invoice_items().length==0)}}var bt=(()=>{class i{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new Ye,this.onHide=new Ye,this.stockService=d(st),this.editInvoiceService=d(St),this.authService=d(be),this.confirmationService=d(Se),this.notificationsService=d(te),this.supplyService=d(_t),this.dateService=d(R),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new We,this.supplier_id=null,this.invoice_number="123",this.invoice_items=O([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new J,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(r=>!r.unit_price||!r.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let r=this.supplyService.factor(),t=structuredClone(this.invoice_items()),l=t.find(y=>y.product_id===e.product_id);l?l.quantity+=r:t.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:e.unit_cost_usd,unit_price:e.unit_cost_usd,quantity:r,unit_abbreviation:e.unit_abbreviation,product_unit_id:e.unit_id_fk}),this.invoice_items.set(t),this.supplyService.factor.set(1),this.calculateTotal("add")}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let r=-1,t=["*","+"];for(let U=0;U<t.length;U++)if(e.indexOf(t[U])!==-1){r=e.indexOf(t[U]);break}let l=e.substring(0,r)||1,y=parseInt(e.substring(r+1,e.length));r!=-1&&r!=0?(this.supplyService.factor.set(parseInt(l)),this.supplyService.submitBarcode(y)):this.supplyService.submitBarcode(e)}}calculateTotal(e){let r=new We,t=this.invoice_items();return t.length>0&&(t.forEach(l=>{r.total_qty+=l.quantity,r.cost_dollar+=l.unit_cost*l.quantity,r.subtotal_dollar+=l.unit_price*l.quantity}),r.total_dollar=r.subtotal_dollar-r.discount_dollar),this.invoiceTotal=r,r}submitEditInvoice(){let e=this.validateItems();!e&&this.supplier_id?this.return_invoice_edit?this.editInvoiceService.returnCheckout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):e&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(e){let r=this.products(),t=[],l=e.query;for(let y=0;y<r.length;y++){let U=r[y];U.product_name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(U)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(e){}removeRow(e){this.invoice_items().splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new We}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ke],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"p-error"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash","severity","danger",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"],["pButton","","pRipple","","label","Cancel Edit","icon","pi pi-times",1,"p-button-secondary","w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["pRipple","","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"]],template:function(r,t){r&1&&(n(0,"p-dialog",2),D("visibleChange",function(y){return E(t.visible,y)||(t.visible=y),y}),u("onHide",function(){return t.closeEditDialog()}),v(1,pi,35,28,"ng-template",3)(2,ci,3,4,"ng-template",4),o(),n(3,"products-dialog",5),u("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(y){return t.assignSelectedProducts(y)}),o()),r&2&&(X(I(8,$t)),T("visible",t.visible),p("modal",!0)("closable",!0)("maximizable",!0),s(3),p("visible",t.productsDialogVisible)("products",t.products))},dependencies:[fe,ee,V,xe,Oe,N,M,rt,at,W,B,F,ne,$,k,nt,mt,P,ct],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]})}}return i})();var di=()=>[10,25,50],ui=()=>({width:"95vw"});function _i(i,m){i&1&&(n(0,"tr")(1,"th"),a(2,"Invoice #"),o(),n(3,"th"),a(4,"Supplier"),o(),n(5,"th"),a(6,"Datetime"),o(),n(7,"th"),a(8,"total"),o(),n(9,"th",19),a(10,"Options"),o()())}function hi(i,m){if(i&1){let e=b();n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),o(),n(7,"td"),a(8),S(9,"currency"),o(),n(10,"td")(11,"button",20),u("click",function(){let t=_(e).$implicit,l=c();return h(l.showInvoiceDialog(t))}),o()(),n(12,"td")(13,"button",21),u("click",function(){let t=_(e).$implicit,l=c();return h(l.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.invoice_number),s(2),g(e.supplier_name||"---"),s(2),g(e.order_date),s(2),g(C(9,5,e.total_cost)),s(5),p("disabled",!0)}}function gi(i,m){i&1&&(n(0,"tr")(1,"td",22),a(2,"No Records Found!"),o()())}function fi(i,m){i&1&&(n(0,"tr")(1,"th",25),a(2,"Barcode"),o(),n(3,"th",26),a(4,"Description"),o(),n(5,"th",25),a(6,"Unit Price"),o(),n(7,"th",27),a(8,"Qty"),o(),n(9,"th",25),a(10,"Total Price"),o()())}function yi(i,m){if(i&1&&(n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),S(7,"currency"),o(),n(8,"td"),a(9),o(),n(10,"td"),a(11),S(12,"currency"),o()()),i&2){let e=m.$implicit;s(2),g(e.barcode||"---"),s(2),g(e.product_name),s(2),x(" ",C(7,5,e.unit_cost)," "),s(3),g(e.quantity),s(2),x(" ",C(12,7,e.unit_cost*e.quantity)," ")}}function vi(i,m){if(i&1&&(n(0,"tr"),f(1,"td")(2,"td")(3,"td"),n(4,"td"),a(5),o(),n(6,"td"),a(7),S(8,"currency"),o()()),i&2){let e=c(3);s(5),g(e.selectedInvoiceTotals.totalQty),s(2),x(" ",C(8,2,e.selectedInvoiceTotals.totalCost)," ")}}function Si(i,m){if(i&1&&(n(0,"p-table",24),v(1,fi,11,0,"ng-template",12)(2,yi,13,9,"ng-template",13)(3,vi,9,4,"ng-template",17),o()),i&2){let e=c(2);p("value",e.invoiceItems)}}function Ci(i,m){if(i&1&&v(0,Si,4,1,"p-table",23),i&2){let e=c();p("ngIf",e.invoiceItems.length!=0)}}function bi(i,m){if(i&1){let e=b();n(0,"button",28),u("click",function(){_(e);let t=c();return h(t.hideInvoiceDialog())}),o()}}var wt=(()=>{class i{constructor(){this.suppliersService=d(oe),this.historyService=d(Q),this.decimalService=d(Fe),this.printService=d(Ne),this.suppliers=this.suppliersService.suppliers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new J,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ie({invoice_number:new H(null),supplier_id:new H(null),invoice_date:new H(null)})}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,xt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{console.log(r),this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost*r.quantity)}),this.detailsDialogVisible=!0}printDelivery(e){}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(e){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(e){this.printService.print(e,"sale")}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["app-supply-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click","disabled"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","5%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),f(7,"input",6),o(),n(8,"div",5),f(9,"p-dropdown",7),o(),n(10,"div",5),f(11,"p-calendar",8),o(),n(12,"div",5),f(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),v(16,_i,11,0,"ng-template",12)(17,hi,14,7,"ng-template",13)(18,gi,3,0,"ng-template",14),o()()()(),n(19,"p-dialog",15),D("visibleChange",function(y){return E(t.detailsDialogVisible,y)||(t.detailsDialogVisible=y),y}),u("onHide",function(){return t.hideInvoiceDialog()}),v(20,Ci,1,1,"ng-template",16)(21,bi,1,0,"ng-template",17),o(),n(22,"edit-purchase",18),u("onHide",function(){return t.closeEditDialog()})("onSubmit",function(y){return t.submitEdit(y)}),o()),r&2&&(s(3),p("toggleable",!0),s(),p("formGroup",t.searchForm),s(5),p("options",t.suppliers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),s(2),p("loading",t.loading()),s(),p("disabled",t.loading()),s(),p("value",t.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(28,di))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),X(I(29,ui)),T("visible",t.detailsDialogVisible),p("modal",!0)("closable",!0)("maximizable",!0),s(3),p("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("suppliers",t.suppliers()))},dependencies:[ee,Y,L,V,z,j,A,N,M,W,B,F,ne,G,$,k,K,bt,P]})}}return i})();var xi=()=>[10,25,50];function wi(i,m){i&1&&(n(0,"tr")(1,"th"),a(2,"Payment #"),o(),n(3,"th"),a(4,"Supplier"),o(),n(5,"th"),a(6,"Datetime"),o(),n(7,"th"),a(8,"total"),o(),n(9,"th",16),a(10,"Options"),o()())}function Ti(i,m){if(i&1){let e=b();n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),o(),n(7,"td"),a(8),S(9,"currency"),o(),n(10,"td")(11,"button",17),u("click",function(){let t=_(e).$implicit,l=c();return h(l.printInvoice(t))}),o()(),n(12,"td")(13,"button",18),u("click",function(){let t=_(e).$implicit,l=c();return h(l.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;s(2),g(e.journal_number),s(2),g(e.partner_name),s(2),g(e.payment_date),s(2),g(C(9,4,e.total_value))}}function Ei(i,m){i&1&&(n(0,"tr")(1,"td",19),a(2,"No Records Found!"),o()())}var Tt=(()=>{class i{constructor(){this.suppliersService=d(oe),this.historyService=d(Q),this.dateService=d(R),this.suppliers=this.suppliersService.suppliers,this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new J,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ie({payment_date:new H(null),partner_id:new H(null),payment_number:new H(null)})}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=this.dateService.formatDate(this.searchForm.value.payment_date)),this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}showInvoiceDialog(e){}printInvoice(e){}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.historyService.fetchReceiptsHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["app-receipts-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),f(7,"input",6),o(),n(8,"div",5),f(9,"p-dropdown",7),o(),n(10,"div",5),f(11,"p-calendar",8),o(),n(12,"div",5),f(13,"p-button",9),n(14,"p-button",10),u("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),v(16,wi,11,0,"ng-template",12)(17,Ti,14,6,"ng-template",13)(18,Ei,3,0,"ng-template",14),o()()()(),n(19,"supplier-payment-dialog",15),u("onClose",function(){return t.hidePaymentDialog()})("onSubmit",function(y){return t.getPaymentDilogResult(y)}),o()),r&2&&(s(3),p("toggleable",!0),s(),p("formGroup",t.searchForm),s(5),p("options",t.suppliers())("loading",t.suppliersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),s(2),p("showIcon",!1)("showClear",!0)("readonlyInput",!0),s(2),p("loading",t.loading()),s(),p("disabled",t.loading()),s(),p("value",t.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(22,xi))("alwaysShowPaginator",!1)("loading",t.loading()),s(4),p("visible",t.editDialogVisible)("selected_payment",t.selectedPayment)("accounts",t.suppliers()))},dependencies:[Y,L,V,z,j,A,N,M,W,B,F,G,$,k,K,qe,P]})}}return i})();var Et=(()=>{class i{constructor(){this.api=d(Ce),this.notificationService=d(te),this.http=d(ve),this.dateService=d(R),this.startDate=O(this.dateService.getStartOfMonth()),this.endDate=O(this.dateService.getCurrentDate()),this.loadingTransactions=O(!1),this.cashTransactions=O([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"YYYY-MM-DD"))}getCashTransactions(e,r){this.loadingTransactions.set(!0),e=this.dateService.formatDate(e,"YYYY-MM-DD"),r=this.dateService.formatDate(r,"YYYY-MM-DD"),this.http.get(`${this.api.host()}/balance/transactions/${e}&${r}`).subscribe({next:t=>{this.cashTransactions.set(t),this.loadingTransactions.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.loadingTransactions.set(!1)}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ue({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Di=(i,m)=>({"text-300":i,"text-green-600":m}),Ii=(i,m)=>({"text-300":i,"text-red-600":m}),Pi=(i,m,e)=>({"text-red-600":i,"text-green-600":m,"font-bold":e}),Mi=(i,m)=>({"text-red-600":i,"text-green-600":m});function Vi(i,m){if(i&1){let e=b();n(0,"label",9),a(1,"Start Date:"),o(),n(2,"p-calendar",10),D("ngModelChange",function(t){_(e);let l=c();return E(l.startDate,t)||(l.startDate=t),h(t)}),u("onSelect",function(){_(e);let t=c();return h(t.startDateChanged())}),o()}if(i&2){let e=c();s(2),T("ngModel",e.startDate),p("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Hi(i,m){if(i&1){let e=b();n(0,"label",9),a(1,"End Date:"),o(),n(2,"p-calendar",10),D("ngModelChange",function(t){_(e);let l=c();return E(l.endDate,t)||(l.endDate=t),h(t)}),u("onSelect",function(){_(e);let t=c();return h(t.endDateChanged())}),o()}if(i&2){let e=c();s(2),T("ngModel",e.endDate),p("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Fi(i,m){if(i&1){let e=b();n(0,"p-button",11),u("onClick",function(){_(e);let t=c();return h(t.selectToday())}),o(),n(1,"p-button",12),u("onClick",function(){_(e);let t=c();return h(t.selectThisMonth())}),o(),n(2,"p-button",13),u("onClick",function(){_(e);let t=c();return h(t.selectThisYear())}),o()}i&2&&(p("size","small"),s(),p("size","small"),s(),p("size","small"))}function Bi(i,m){i&1&&(n(0,"tr")(1,"th",14),a(2,"Date"),o(),n(3,"th",14),a(4,"Transaction"),o(),n(5,"th",15),a(6,"Description"),o(),n(7,"th",15),a(8,"Debit"),o(),n(9,"th",15),a(10,"Credit"),o(),n(11,"th",15),a(12,"Balance"),o()())}function ki(i,m){if(i&1&&(n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),o(),n(7,"td",16),a(8),S(9,"currency"),o(),n(10,"td",16),a(11),S(12,"currency"),o(),n(13,"td",16),a(14),S(15,"currency"),o()()),i&2){let e=m.$implicit,r=m.rowIndex,t=c();s(2),x(" ",e.journal_date||"Before "+t.startDate()," "),s(2),g(e.journal_number||"---"),s(2),g(e.journal_description||"---"),s(),p("ngClass",Z(15,Di,e.debit==0,e.debit!=0)),s(),x(" ",C(9,9,e.debit)," "),s(2),p("ngClass",Z(18,Ii,e.credit==0,e.credit!=0)),s(),x(" ",C(12,11,e.credit)," "),s(2),p("ngClass",Je(21,Pi,t.balances[r]<0,t.balances[r]>0,t.balances[r]==0)),s(),x(" ",C(15,13,t.balances[r])," ")}}function Ni(i,m){if(i&1&&(n(0,"tr"),f(1,"td",17),n(2,"td"),a(3,"Balance Due"),o(),n(4,"td",16),a(5),S(6,"currency"),o()()),i&2){let e=c();s(4),p("ngClass",Z(4,Mi,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),s(),x(" ",C(6,2,e.balances[e.balances.length-1])," ")}}var Le=(()=>{class i{constructor(){this.transactionService=d(Et),this.fb=d(we),this.dateService=d(R),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.submitSearch(),ge(()=>{let e=this.cashTransactions();if(e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let r=1;r<e.length;r++)this.balances[r]=this.balances[r-1]+parseFloat(e[r].debit)-parseFloat(e[r].credit)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["cash-transactions"]],standalone:!0,features:[Ue],decls:11,vars:2,consts:[[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","20%"],["width","15%"],[3,"ngClass"],["colspan","4"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-toolbar"),v(4,Vi,3,6,"ng-template",2)(5,Hi,3,6,"ng-template",3)(6,Fi,3,3,"ng-template",4),o(),n(7,"p-table",5),v(8,Bi,13,0,"ng-template",6)(9,ki,16,25,"ng-template",7)(10,Ni,7,7,"ng-template",8),o()()()()),r&2&&(s(7),p("value",t.cashTransactions())("scrollable",!0))},dependencies:[Ee,F,M,ke,Ie,Me,k,B,Ve,N,De,P,Pe,Te,V,Xe,xe,ye,fe,Re,pt]})}}return i})();var Dt=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=w({type:i,selectors:[["app-cash-history"]],decls:1,vars:0,template:function(r,t){r&1&&f(0,"cash-transactions")},dependencies:[Le]})}}return i})();var Oi=[{path:"sales-history",data:{breadcrumb:"sales"},component:yt},{path:"payment-history",data:{breadcrumb:"payments"},component:vt},{path:"purchases-history",data:{breadcrumb:"purchases"},component:wt,canActivate:[et]},{path:"receipts-history",data:{breadcrumb:"receipts"},component:Tt},{path:"cash-history",data:{breadcrumb:"Cash"},component:Dt}],It=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=he({type:i})}static{this.\u0275inj=_e({imports:[je.forChild(Oi),je]})}}return i})();var mr=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=he({type:i})}static{this.\u0275inj=_e({imports:[ye,It,Te,Ze,Oe,Ve,De,Ee,it,Ie,Re,Pe,Me,ke,ht,ot,gt,dt,ut,Be,qe,Le]})}}return i})();export{mr as HistoryModule};
