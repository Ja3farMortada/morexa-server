import{a as ve}from"./chunk-QQB6G7QH.js";import{a as ye,b as fe}from"./chunk-SMYUZXME.js";import{c as re}from"./chunk-GWBVNARG.js";import{a as le}from"./chunk-BKTAQ5YZ.js";import{a as Ce}from"./chunk-HIEQKMYW.js";import{a as be}from"./chunk-GOI4EBGB.js";import{a as De}from"./chunk-6AMBXUQL.js";import{b as de,c as _e}from"./chunk-V5S3SSVI.js";import{i as pe,j as ue,m as he,n as ge}from"./chunk-DHXFVDEA.js";import{A as u,Aa as f,Ba as C,Da as H,E as I,Ea as F,Fa as D,Fc as me,Gc as ce,Hb as J,Kb as K,Lb as X,N as m,Na as P,Oa as B,Rb as Z,U as T,Va as Q,Wb as ee,X as _,Xa as Y,Z as r,Za as z,_b as te,a as W,aa as L,ac as ie,bb as A,bc as ne,cb as $,d as E,da as a,ea as o,eb as U,fa as R,ja as v,ka as h,la as c,lc as ae,mc as oe,o as j,oc as se,r as b,ra as w,s as d,sa as x,t as N,ta as S,va as l,wa as V,xa as O,y as q,yb as G,z as p,za as y}from"./chunk-KWICCDR6.js";import{g as Se}from"./chunk-WWX6BADO.js";var we=(()=>{class i{constructor(e,n,t){this.http=e,this.api=n,this.notificationService=t,this.signal_loading=T(!1),this.visible$=new E(!1),this.status_action$=new E({}),this.onSubmit=T(null),this.cashBalanceService=d(le)}submitCustomerPayment(e){this.signal_loading.set(!0),this.http.post(`${this.api.host()}/payment/customer`,e).subscribe({next:n=>{this.notificationService.showSuccess("Payment submitted successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.onSubmit.set({action:"add"}),this.cashBalanceService.getBalance()}})}submitCustomerEditPayment(e){this.signal_loading.set(!0),this.http.put(`${this.api.host()}/payment/customer`,e).subscribe({next:n=>{this.notificationService.showSuccess("Payment edited successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.onSubmit.set({action:"update"}),this.cashBalanceService.getBalance()}})}deletePayment(e){this.signal_loading.set(!0),this.http.delete(`${this.api.host()}/payment/${e}`).subscribe({next:n=>{this.notificationService.showSuccess("Payment deleted successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.onSubmit.set({action:"delete"}),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(n){return new(n||i)(b(U),b(X),b(K))}}static{this.\u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var xe=Se(De());var Be=["amountInput"],Me=["customerDropdown"],Ee=["paymentDateCalendar"],Ie=()=>({width:"75vw"}),Te=()=>({"1199px":"85vw","575px":"95vw"}),k=i=>({"ng-invalid ng-dirty":i});function Ve(i,g){i&1&&(a(0,"small",17),l(1,"Customer is required."),o())}function Fe(i,g){i&1&&(a(0,"small",17),l(1,"Date is required."),o())}function ke(i,g){i&1&&(a(0,"small",17),l(1,"Ammount is required."),o())}function We(i,g){if(i&1&&(a(0,"div",18)(1,"div",19)(2,"table",20)(3,"tr")(4,"th",21),l(5,"Old Balance:"),o(),a(6,"th")(7,"text-with-loading",22)(8,"span"),l(9),P(10,"currency"),o()()()(),a(11,"tr")(12,"th",21),l(13,"Applied Debt"),o(),a(14,"th"),l(15),P(16,"currency"),o()(),a(17,"tr")(18,"td",23),R(19,"p-divider",24),o()(),a(20,"tr")(21,"th",21),l(22,"Remaining Balance:"),o(),a(23,"th")(24,"text-with-loading",25)(25,"span"),l(26),P(27,"currency"),o()()()()()()()),i&2){let e=c(2);m(7),r("isLoading",e.customer_balance_loading())("loadingBar",!0),m(2),V(B(10,7,e.customer_balance().balance)),m(6),O(" ",B(16,9,e.amount)," "),m(9),r("isLoading",e.customer_balance_loading())("loadingBar",!0),m(2),V(B(27,11,e.calculateNewBalance(e.customer_balance().balance,e.amount||0)))}}function je(i,g){if(i&1){let e=v();a(0,"div",5)(1,"div",6)(2,"div",7)(3,"label",8),l(4,"Customer"),a(5,"span",9),l(6," *"),o()(),a(7,"p-dropdown",10),h("onChange",function(){p(e);let t=c();return u(t.getCustomerBalance())}),C("ngModelChange",function(t){p(e);let s=c();return f(s.current_account,t)||(s.current_account=t),u(t)}),o(),_(8,Ve,2,0,"small",11),o()(),a(9,"div",6)(10,"label",12),l(11," Payment Date "),a(12,"span",9),l(13," *"),o()(),a(14,"p-calendar",13,0),C("ngModelChange",function(t){p(e);let s=c();return f(s.payment_date,t)||(s.payment_date=t),u(t)}),o(),_(16,Fe,2,0,"small",11),o(),a(17,"div",6)(18,"div",7)(19,"label",14),l(20,"Amount"),a(21,"span",9),l(22," *"),o()(),a(23,"p-inputNumber",15,1),C("ngModelChange",function(t){p(e);let s=c();return f(s.amount,t)||(s.amount=t),u(t)}),h("onFocus",function(t){p(e);let s=c();return u(s.selectInput(t))}),o(),_(25,ke,2,0,"small",11),o()()(),_(26,We,28,13,"div",16)}if(i&2){let e=c();m(7),r("options",e.accounts),y("ngModel",e.current_account),r("required",!0)("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",D(23,k,e.submitted&&!e.current_account)),m(),r("ngIf",e.submitted&&!e.current_account),m(6),y("ngModel",e.payment_date),r("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0)("ngClass",D(25,k,!e.payment_date)),m(2),r("ngIf",e.submitted&&!e.payment_date),m(7),y("ngModel",e.amount),r("required",!0)("autofocus",e.selected_account)("step",1)("min",0)("ngClass",D(27,k,e.submitted&&!e.amount)),m(2),r("ngIf",e.submitted&&!e.amount),m(),r("ngIf",e.current_account)}}function Ne(i,g){if(i&1){let e=v();a(0,"p-button",29),h("onClick",function(){p(e);let t=c(2);return u(t.deletePayment())}),o()}if(i&2){let e=c(2);r("disabled",e.loading())}}function qe(i,g){if(i&1){let e=v();_(0,Ne,1,1,"p-button",26),a(1,"p-button",27),h("onClick",function(){p(e);let t=c();return u(t.closeDialog())}),o(),a(2,"p-button",28),h("onClick",function(){p(e);let t=c();return u(t.submitPayment())}),o()}if(i&2){let e=c();r("ngIf",e.dialog_mode==="edit"),m(),r("disabled",e.loading()),m(),r("loading",e.loading())}}var xt=(()=>{class i{constructor(){this.visible=!1,this.accounts=[],this.dialog_mode="add",this.type="customer",this.onClose=new I,this.onSubmit=new I,this.current_account=null,this.subscriptions=new W,this.customersService=d(Ce),this.paymentService=d(we),this.confirmationService=d(G),this.dateService=d(be),this.decimalService=d(ve),this.amount=0,this.submitted=!1,this.loading=this.paymentService.signal_loading,this.payment_date=this.dateService.getCurrentDatetime(),this.customer_balance_loading=this.customersService.signal_balanceLoading,this.customer_balance=this.customersService.customersTotalDebts$,Q(()=>{let e=this.paymentService.onSubmit();e&&this.onSubmit.emit(e)})}ngOnInit(){this.subscriptions.add(this.paymentService.visible$.subscribe(e=>{this.visible=e}))}ngOnChanges(){this.visible&&this.dialog_mode==="edit"&&this.selected_payment?(this.amount=this.selected_payment.total_value,this.payment_date=this.dateService.formatDate(this.selected_payment.payment_date,"YYYY-MM-DD HH:mm"),this.current_account=this.selected_payment.partner_id):this.visible&&this.dialog_mode==="add"&&(this.payment_date=this.dateService.getCurrentDatetime(),this.current_account=this.selected_account),this.getCustomerBalance()}ngOnDestroy(){this.subscriptions.unsubscribe()}closeDialog(){this.visible=!1,this.onClose.emit(),this.submitted=!1,this.amount=0}submitPayment(){this.submitted=!0,this.amount>0&&this.current_account&&this.payment_date?(this.payment_date=(0,xe.default)(this.payment_date).format("YYYY-MM-DD HH:mm:ss"),this.dialog_mode==="add"?this.paymentService.submitCustomerPayment({amount:this.amount,account_id:this.current_account,payment_date:this.payment_date}):this.paymentService.submitCustomerEditPayment({amount:this.amount,account_id:this.current_account,payment_date:this.payment_date,journal_id:this.selected_payment.journal_id})):this.amount?this.current_account?this.paymentDateCalendar.inputfieldViewChild.nativeElement.focus():this.customerDropdown.applyFocus():this.amountInput.el.nativeElement.children[0].children[0].focus()}deletePayment(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.paymentService.deletePayment(this.selected_payment.journal_id)}})}selectInput(e){e.target.select()}getCustomerBalance(){this.current_account&&this.customersService.getAccountTotalBalance(this.current_account)}calculateNewBalance(e=0,n=0){return e=parseFloat(e),this.decimalService.subtract(e,n)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=N({type:i,selectors:[["payment-dialog"]],viewQuery:function(n,t){if(n&1&&(w(Be,5),w(Me,5),w(Ee,5)),n&2){let s;x(s=S())&&(t.amountInput=s.first),x(s=S())&&(t.customerDropdown=s.first),x(s=S())&&(t.paymentDateCalendar=s.first)}},inputs:{visible:"visible",accounts:"accounts",selected_account:"selected_account",selected_payment:"selected_payment",dialog_mode:"dialog_mode",type:"type"},outputs:{onClose:"onClose",onSubmit:"onSubmit"},standalone:!0,features:[q,H],decls:3,vars:10,consts:[["paymentDateCalendar",""],["amountInput",""],["position","top","header","Receive Payment","styleClass","p-fluid",3,"visibleChange","onHide","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],[1,"flex","flex-column","gap-2"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"onChange","ngModelChange","options","ngModel","required","filter","showClear","autoOptionFocus","ngClass"],["class","p-error",4,"ngIf"],["for","payment_date"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","showTime","ngClass"],["for","amount"],["styleClass","input-align-center","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm",3,"ngModelChange","onFocus","ngModel","required","autofocus","step","min","ngClass"],["class","grid",4,"ngIf"],[1,"p-error"],[1,"grid"],[1,"col-4"],[1,"text-left"],[1,"text-green-500"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","50%",3,"isLoading","loadingBar"],["colspan","2"],["styleClass","m-0"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","63%",3,"isLoading","loadingBar"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"disabled","onClick",4,"ngIf"],["pRipple","","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","disabled"],["pRipple","","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","loading"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"onClick","disabled"]],template:function(n,t){n&1&&(a(0,"p-dialog",2),C("visibleChange",function(M){return f(t.visible,M)||(t.visible=M),M}),h("onHide",function(){return t.closeDialog()}),_(1,je,27,29,"ng-template",3)(2,qe,3,3,"ng-template",4),o()),n&2&&(L(F(8,Ie)),r("modal",!0),y("visible",t.visible),r("breakpoints",F(9,Te))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[ce,me,J,oe,ae,se,_e,de,ue,pe,$,Y,z,A,ie,Z,te,ee,ne,ge,he,re,fe,ye]})}}return i})();export{we as a,xt as b};
