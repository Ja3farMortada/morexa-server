import{a as lt,b as st,c as mt}from"./chunk-4ERIIQYJ.js";import{a as oe}from"./chunk-PGVA3SHS.js";import{a as $e,b as Ue}from"./chunk-QAZ3BDUJ.js";import{b as et}from"./chunk-AEN6MWV3.js";import{b as nt}from"./chunk-PXVOD3QY.js";import"./chunk-SPKEVXDM.js";import{a as ot,b as rt,d as at}from"./chunk-EEGLTAQO.js";import{b as it}from"./chunk-V7IGKE33.js";import{b as Pe}from"./chunk-42IGJLG2.js";import{b as j}from"./chunk-SE472FFV.js";import{b as Ke}from"./chunk-UCUUKJUF.js";import{a as Ge}from"./chunk-2NI67QZK.js";import{a as Je}from"./chunk-N4OSQ2YP.js";import{a as Qe,b as He}from"./chunk-LH4OTLL6.js";import"./chunk-UHFQUA5D.js";import"./chunk-7THMIGUD.js";import{a as W}from"./chunk-2SXB7SA4.js";import{a as qe}from"./chunk-HY5F37U4.js";import{a as Et}from"./chunk-6AMBXUQL.js";import"./chunk-YW57MKXO.js";import{a as Xe,b as Ze}from"./chunk-6OAFLMEG.js";import"./chunk-TAW6AXMG.js";import"./chunk-3TMRKM3A.js";import{c as Le,f as F,i as We,j as je,q as Oe}from"./chunk-V5RHMPQH.js";import{b as tt}from"./chunk-BHJDGOJF.js";import"./chunk-LQTJ6KB6.js";import"./chunk-OVJQWTCG.js";import"./chunk-ZZBHPNZI.js";import{a as z,b as Me}from"./chunk-H6U4N3TG.js";import{i as Ae,j as Ye,m as ze,n as Ne}from"./chunk-LH73PZKM.js";import{$ as de,A as f,Aa as V,Ba as M,Ea as w,Fa as _e,Fc as ne,Ga as J,Gc as Re,Hb as Y,M as $,N as a,Na as x,Nb as be,Oa as T,Pb as Ce,Rb as Z,Sb as Se,Tb as ye,Vb as L,Wb as ve,X as S,Xa as X,Xb as we,Yb as De,Z as m,Za as fe,Zb as xe,_b as Te,a as pe,aa as U,ac as Ee,ba as ue,bb as I,bc as Ve,cb as ge,da as n,ea as o,fa as b,fc as Ie,ic as ee,ja as v,jc as Fe,ka as d,kc as te,la as u,lc as N,mc as ke,nc as ie,oc as Be,p as G,ra as k,s as y,sa as B,t as R,ta as P,tb as se,u as K,ua as A,va as l,wa as C,xa as D,yb as he,z as _,za as E}from"./chunk-4RWQR7BF.js";import{g as Tt,h as ce}from"./chunk-WWX6BADO.js";var O=Tt(Et());var It=["dt"],Ft=()=>({"min-width":"45rem"}),kt=(i,c)=>({"text-300":i,"text-red-600":c}),Bt=(i,c)=>({"text-300":i,"text-green-600":c}),Pt=(i,c)=>({"text-green-600":i,"text-red-600":c});function Rt(i,c){i&1&&(n(0,"tr"),b(1,"th"),n(2,"th"),l(3,"Date"),o(),n(4,"th"),l(5,"#"),o(),n(6,"th"),l(7,"Description"),o(),n(8,"th"),l(9,"Notes"),o(),n(10,"th"),l(11,"Debit"),o(),n(12,"th"),l(13,"Credit"),o(),n(14,"th"),l(15,"Balance"),o()())}function At(i,c){if(i&1&&b(0,"i",27),i&2){let e=u(),r=e.$implicit,t=e.expanded;ue(t?"pi pi-chevron-down":"pi pi-chevron-right"),m("pRowToggler",r)}}function Yt(i,c){if(i&1&&(n(0,"td",28),l(1),o()),i&2){let e=u(3);a(),D(" Before ",e.startDate," ")}}function Lt(i,c){if(i&1&&(n(0,"td"),l(1),o()),i&2){let e=u().$implicit;a(),D(" ",e.journal_date," ")}}function zt(i,c){if(i&1&&(n(0,"tr")(1,"td"),S(2,At,1,3,"i",22),o(),S(3,Yt,2,1,"td",23)(4,Lt,2,1,"td",24),n(5,"td"),l(6),o(),n(7,"td"),b(8,"p-tag",25),o(),n(9,"td"),l(10),o(),n(11,"td",26),l(12),x(13,"currency"),o(),n(14,"td",26),l(15),x(16,"currency"),o(),n(17,"td"),l(18),x(19,"currency"),o()()),i&2){let e=c.$implicit,r=c.rowIndex,t=u(2);a(2),m("ngIf",e.order_id),a(),m("ngIf",!e.journal_date),a(),m("ngIf",e.journal_date),a(2),C(e.journal_number||"---"),a(2),m("value",e.journal_description)("severity",t.getSeverity(e.journal_description)),a(2),C(e.journal_notes||"---"),a(),m("ngClass",J(18,kt,e.debit==0,e.debit!=0)),a(),D(" ",T(13,12,e.debit)," "),a(2),m("ngClass",J(21,Bt,e.credit==0,e.credit!=0)),a(),D(" ",T(16,14,e.credit)," "),a(3),D(" ",T(19,16,t.balances[r])," ")}}function Nt(i,c){i&1&&(n(0,"tr")(1,"th"),l(2,"Description"),o(),n(3,"th"),l(4,"Unit Price"),o(),n(5,"th"),l(6,"Quantity"),o(),n(7,"th"),l(8,"Total Price"),o()())}function Wt(i,c){if(i&1&&(n(0,"tr",31)(1,"td"),l(2),o(),n(3,"td"),l(4),x(5,"currency"),o(),n(6,"td"),l(7),o(),n(8,"td"),l(9),x(10,"currency"),o()()),i&2){let e=c.$implicit;a(2),D(" ",e.product_name," "),a(2),D(" ",T(5,4,e.unit_price)," "),a(3),C(e.quantity),a(2),D(" ",T(10,6,e.total_price)," ")}}function jt(i,c){if(i&1&&(n(0,"tr"),b(1,"td"),n(2,"td",29)(3,"p-table",30),S(4,Nt,9,0,"ng-template",18)(5,Wt,11,8,"ng-template",19),o()(),b(6,"td"),o()),i&2){let e=c.$implicit,r=u(2);a(3),m("value",r.getFilteredDetails(e))}}function Ot(i,c){if(i&1&&(n(0,"tr"),b(1,"td",32),n(2,"td"),l(3,"Balance Due"),o(),n(4,"td",33),l(5),x(6,"currency"),o()()),i&2){let e=u(2);a(4),m("ngClass",J(4,Pt,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),a(),D(" ",T(6,2,e.balances[e.balances.length-1])," ")}}function Qt(i,c){if(i&1){let e=v();n(0,"div",2),b(1,"p-divider"),n(2,"p-table",17,0),d("onRowExpand",function(){_(e);let t=u();return f(t.onRowExpand())}),S(4,Rt,16,0,"ng-template",18)(5,zt,20,24,"ng-template",19)(6,jt,7,1,"ng-template",20)(7,Ot,7,7,"ng-template",21),o()()}if(i&2){let e=u();a(2),m("value",e.data)("tableStyle",w(2,Ft))}}var ae=(()=>{class i{constructor(){this.customersService=y(W),this.historyService=y(Je),this.dateService=y(qe),this.currencyPipe=y(I),this.subscriptions=new pe,this.customers=this.customersService.customers,this.startDate=(0,O.default)().startOf("month").format("YYYY-MM-DD"),this.endDate=(0,O.default)().format("YYYY-MM-DD"),this.balances=[],this.show_dollar=!0,this.data=[],this.paymentDialogVisible=!1,this.submitItemLoading=this.customersService.signal_submitItemLoading,this.signal_tableLoading=this.customersService.signal_tableLoading,this.selectedOrderItems=this.historyService.selectedOrderItems,this.correctDebtDialogVisible=!1}ngOnInit(){this.selectedCustomer&&this.getStatements(),this.subscriptions.add(this.customersService.customerBalance$.subscribe(e=>{if(this.data=e,e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let r=1;r<e.length;r++)this.balances[r]=this.balances[r-1]+parseFloat(e[r].debit)-parseFloat(e[r].credit);this.onRowExpand()}else this.balances=[]}))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.customersService.customerBalance$.next([])}startDateChanged(){this.startDate=(0,O.default)(this.startDate).format("YYYY-MM-DD"),this.resetTable(),this.getStatements()}endDateChanged(){this.endDate=(0,O.default)(this.endDate).format("YYYY-MM-DD"),this.resetTable(),this.getStatements()}accountChanged(){this.resetTable(),this.getStatements()}getStatements(){this.selectedCustomer&&this.startDate&&this.endDate&&this.customersService.getCustomerBalance(this.selectedCustomer,this.startDate,this.endDate)}resetTable(){this.data=[],this.balances=[]}getSeverity(e){switch(e){case"Invoice":return"danger";case"Payment Received":return"success";case"Manual Transaction":return"warning";default:return"contrast"}}onRowExpand(){let e=this.data.filter(r=>r.order_id!=null).map(r=>r.order_id);this.data.length>1&&this.historyService.fetchOrderItemsById(e)}getFilteredDetails(e){return this.selectedOrderItems().filter(r=>r.order_id===e.order_id)}formatCurrency(e){return this.currencyPipe.transform(e,"USD","symbol","1.2-2")||""}exportToPDF(){let e=new lt,r=e.internal.pageSize.width,t=this.customers().find(h=>h.account_id===this.selectedCustomer),s=this.dateService.getCurrentDatetime();e.setFontSize(14);let p="Statement of account",g=e.getTextWidth(p);e.text(p,(r-g)/2,10),e.setFontSize(10),e.text(`${t?.name}`,10,20),e.setFontSize(9);let Q=this.dateService.formatDate(this.startDate,"YYYY-MM-DD"),bt=this.dateService.formatDate(this.endDate,"YYYY-MM-DD");e.text(`Start Date: ${Q}`,10,30),e.text(`End Date: ${bt}`,10,35),e.text(`Generated on: ${s}`,150,30);let Ct=["Datetime","Transaction #","Description","Debit","Credit","Balance"],St=this.data.map((h,le)=>[h.journal_date?this.dateService.formatDate(h.journal_date,"YYYY-MM-DD"):`Before ${Q}`,h.journal_number||"---",h.journal_description||"---",{hiddenValue:h.order_id||null,content:this.formatCurrency(h.debit),styles:{textColor:h.debit==0?"#D1D5DB":"#D9342B"}},{content:this.formatCurrency(h.credit),styles:{textColor:h.credit==0?"#D1D5DB":"#1DA750"}},this.formatCurrency(this.balances[le])]),H=[];St.forEach((h,le)=>{if(H.push(h),le>0&&h[3].hiddenValue){let Dt={order_id:h[3].hiddenValue},xt=this.getFilteredDetails(Dt);H.push([{content:"",styles:{fillColor:"white",border:"1px solid black"}},{content:"Description",styles:{fontStyle:"bold",fontSize:7}},{content:"Unit Price",styles:{fontStyle:"bold",fontSize:7}},{content:"Qty",styles:{fontStyle:"bold",fontSize:7}},{content:"Total",styles:{fontStyle:"bold",fontSize:7}},{content:"",styles:{fillColor:"white"}}]),xt.forEach(q=>{H.push([{content:"",styles:{fillColor:"white"}},{content:q.product_name,styles:{fillColor:"#e5e7eb",fontSize:7}},{content:this.formatCurrency(q.unit_price),styles:{fillColor:"#e5e7eb",fontSize:7}},{content:q.quantity,styles:{fillColor:"#e5e7eb",fontSize:7}},{content:this.formatCurrency(q.total_price),styles:{fillColor:"#e5e7eb",fontSize:7}},{content:"",styles:{fillColor:"white"}}])})}});let yt=[{content:"",colSpan:4},"Due",{content:`${this.formatCurrency(this.balances[this.balances.length-1])}`}];st(e,{startY:40,head:[Ct],body:H,foot:[yt],styles:{halign:"center",fontSize:8},headStyles:{fillColor:"F9FAFB",textColor:"#4B5563"},footStyles:{fillColor:"F9FAFB",textColor:"#4B5563"}}),e.setFontSize(10);let vt=e.lastAutoTable.finalY||20,me=`Balance Due: ${this.formatCurrency(this.balances[this.balances.length-1])}`,wt=e.getTextWidth(me);e.text(me,r-wt-15,vt+10),e.save(`${t?.name}-statement.pdf`)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=R({type:i,selectors:[["customer-statements"]],viewQuery:function(r,t){if(r&1&&k(It,5),r&2){let s;B(s=P())&&(t.dt=s.first)}},inputs:{selectedCustomer:"selectedCustomer"},decls:30,vars:26,consts:[["dt",""],[1,"grid","m-1"],[1,"col-12"],[1,"grid"],[1,"col-12","md:col-2"],[1,"flex","flex-column","gap-1"],["optionLabel","name","optionValue","account_id","placeholder","Select Customer","styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","onChange","options","ngModel","showClear","loading","autoOptionFocus","filter"],["styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","appendTo","body",3,"ngModelChange","onSelect","ngModel","showIcon","iconDisplay","readonlyInput"],[1,"col-6","md:col-1","mt-auto"],["label","Refresh","size","small","icon","pi pi-refresh","styleClass","w-full",3,"onClick","loading","disabled"],["label","Export","severity","help","size","small","icon","pi pi-file-pdf","styleClass","w-full",3,"onClick","disabled"],[1,"col-6","md:col-2","mt-auto"],["label","Receive Payment","size","small","icon","pi pi-dollar","severity","success","styleClass","w-full",3,"onClick","disabled"],["label","Correct Debt","size","small","icon","pi pi-dollar","severity","warning","styleClass","w-full",3,"onClick","disabled"],["class","col-12",4,"ngIf"],[3,"onClose","onSubmit","visible","accounts","selected_account"],[3,"onClose","onSubmit","visible","accounts","account"],["dataKey","journal_id","styleClass","p-datatable-sm",1,"ledger_table",3,"onRowExpand","value","tableStyle"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","footer"],["style","cursor: pointer",3,"class","pRowToggler",4,"ngIf"],["class","font-bold",4,"ngIf"],[4,"ngIf"],[3,"value","severity"],[3,"ngClass"],[2,"cursor","pointer",3,"pRowToggler"],[1,"font-bold"],["colspan","5"],["styleClass","p-datatable-sm",3,"value"],[1,"bg-success"],["colspan","6"],[1,"font-bold",3,"ngClass"]],template:function(r,t){r&1&&(n(0,"div",1)(1,"div",2)(2,"p-card")(3,"div",3)(4,"div",4)(5,"div",5)(6,"label"),l(7,"Select Customer:"),o(),n(8,"p-dropdown",6),M("ngModelChange",function(p){return V(t.selectedCustomer,p)||(t.selectedCustomer=p),p}),d("onChange",function(){return t.accountChanged()}),o()()(),n(9,"div",4)(10,"div",5)(11,"label"),l(12,"Start Date:"),o(),n(13,"p-calendar",7),M("ngModelChange",function(p){return V(t.startDate,p)||(t.startDate=p),p}),d("onSelect",function(){return t.startDateChanged()}),o()()(),n(14,"div",4)(15,"div",5)(16,"label"),l(17,"End Date:"),o(),n(18,"p-calendar",7),M("ngModelChange",function(p){return V(t.endDate,p)||(t.endDate=p),p}),d("onSelect",function(){return t.endDateChanged()}),o()()(),n(19,"div",8)(20,"p-button",9),d("onClick",function(){return t.getStatements()}),o()(),n(21,"div",8)(22,"p-button",10),d("onClick",function(){return t.exportToPDF()}),o()(),n(23,"div",11)(24,"p-button",12),d("onClick",function(){return t.paymentDialogVisible=!0}),o()(),n(25,"div",11)(26,"p-button",13),d("onClick",function(){return t.correctDebtDialogVisible=!0}),o()(),S(27,Qt,8,3,"div",14),o()()(),n(28,"payment-dialog",15),d("onClose",function(){return t.paymentDialogVisible=!1})("onSubmit",function(){return t.getStatements()}),o(),n(29,"correct-debt",16),d("onClose",function(){return t.correctDebtDialogVisible=!1})("onSubmit",function(){return t.getStatements()}),o()()),r&2&&(a(8),m("options",t.customers()),E("ngModel",t.selectedCustomer),m("showClear",!0)("loading",t.signal_tableLoading())("autoOptionFocus",!1)("filter",!0),a(5),E("ngModel",t.startDate),m("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),a(5),E("ngModel",t.endDate),m("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),a(2),m("loading",t.submitItemLoading())("disabled",!t.selectedCustomer),a(2),m("disabled",!t.selectedCustomer),a(2),m("disabled",!t.selectedCustomer),a(2),m("disabled",!t.selectedCustomer),a(),m("ngIf",t.data.length>0),a(),m("visible",t.paymentDialogVisible)("accounts",t.customers())("selected_account",t.selectedCustomer),a(),m("visible",t.correctDebtDialogVisible)("accounts",t.customers())("account",t.selectedCustomer))},dependencies:[X,fe,Z,ve,Y,F,je,N,Ae,z,ot,Qe,ze,j,oe,I],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}.bg-success[_ngcontent-%COMP%]{background-color:#d3d3d3}"]})}}return i})();var $t=["tableSearch"],Ut=()=>[10,15,50,100],Jt=()=>["name","balance"],Xt=()=>({width:"95vw"});function Zt(i,c){if(i&1){let e=v();n(0,"span",13),b(1,"i",14),n(2,"input",15,1),d("input",function(t){_(e),u();let s=A(7);return f(s.filterGlobal(t.target.value,"contains"))}),o()(),n(4,"p-button",16),d("click",function(){_(e);let t=u();return f(t.refreshDebts())}),o()}if(i&2){let e=u(),r=A(7);a(2),m("value",r.filters.global==null?null:r.filters.global.value),a(2),m("loading",e.debtsLoading())}}function ei(i,c){if(i&1&&(n(0,"h3"),l(1," Total Debts: "),n(2,"span",17),l(3),x(4,"currency"),o()()),i&2){let e=u();a(3),C(T(4,1,e.calculateTotalDepts()))}}function ti(i,c){i&1&&(n(0,"tr")(1,"th"),l(2,"Account #"),o(),n(3,"th"),l(4,"Customer Name"),o(),n(5,"th"),l(6,"Customer Phone"),o(),n(7,"th"),l(8,"Balance"),o(),n(9,"th"),l(10,"Statement"),o()())}function ii(i,c){if(i&1){let e=v();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),x(9,"currency"),o(),n(10,"td")(11,"p-button",18),d("onClick",function(){let t=_(e).$implicit,s=u();return f(s.showStatement(t))}),o()()()}if(i&2){let e=c.$implicit;a(2),C(e.account_id),a(2),C(e.name),a(2),C(e.phone||"---"),a(2),C(T(9,4,e.balance))}}function ni(i,c){i&1&&(n(0,"tr")(1,"td",19),l(2,"No records yet!"),o()())}function oi(i,c){if(i&1&&b(0,"customer-statements",20),i&2){let e=u();m("selectedCustomer",e.selectedCustomerId)}}function ri(i,c){if(i&1){let e=v();n(0,"button",21),d("click",function(){_(e);let t=u();return f(t.hideStatementDialog())}),o()}}var ft=(()=>{class i{constructor(){this.customersService=y(W),this.decimalService=y(Ge),this.debts=this.customersService.debts,this.debtsLoading=this.customersService.debtsLoading,this.statementDialogVisible=!1,this.totalDebts=0}ngOnInit(){this.customersService.getDebts()}refreshDebts(){this.customersService.getDebts()}showStatement(e){this.selectedCustomerId=e.account_id,this.statementDialogVisible=!0}hideStatementDialog(){this.statementDialogVisible=!1}calculateTotalDepts(){let e=0,r=this.debts();return r.length>0&&r.forEach(t=>{e=this.decimalService.add(e,t.balance)}),e}onKeyDown(e){this.statementDialogVisible||(this.tableSearch.nativeElement.focus(),e.key=="Enter"&&this.tableSearch.nativeElement.select())}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=R({type:i,selectors:[["app-debts"]],viewQuery:function(r,t){if(r&1&&k($t,5),r&2){let s;B(s=P())&&(t.tableSearch=s.first)}},hostBindings:function(r,t){r&1&&d("keydown",function(p){return t.onKeyDown(p)},!1,$)},decls:14,vars:18,consts:[["dt2",""],["tableSearch",""],[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm","dataKey","account_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["label","Refresh","icon","pi pi-refresh","size","small","styleClass","mx-2 ",3,"click","loading"],[1,"text-red-500"],["size","small","severity","secondary","icon","pi pi-eye",3,"onClick"],["colspan","5"],[3,"selectedCustomer"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){if(r&1){let s=v();n(0,"div",2)(1,"div",3)(2,"p-card")(3,"p-toolbar"),S(4,Zt,5,2,"ng-template",4)(5,ei,5,3,"ng-template",5),o(),n(6,"p-table",6,0),S(8,ti,11,0,"ng-template",7)(9,ii,12,6,"ng-template",8)(10,ni,3,0,"ng-template",9),o()()()(),n(11,"p-dialog",10),M("visibleChange",function(g){return _(s),V(t.statementDialogVisible,g)||(t.statementDialogVisible=g),f(g)}),d("onHide",function(){return _(s),f(t.hideStatementDialog())}),S(12,oi,1,1,"ng-template",11)(13,ri,1,0,"ng-template",12),o()}r&2&&(a(6),m("value",t.debts())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",w(15,Ut))("alwaysShowPaginator",!0)("globalFilterFields",w(16,Jt))("filterDelay",0)("loading",t.debtsLoading()),a(5),U(w(17,Xt)),E("visible",t.statementDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[Y,F,te,N,ne,Xe,ee,ie,z,ae,I]})}}return i})();var ai=["tableSearch"],li=()=>[10,15,50,100],si=()=>["name","phone","financial_number"],mi=()=>({width:"55vw"}),ci=()=>({"1199px":"55vw","575px":"95vw"}),pi=i=>({"ng-invalid ng-dirty":i});function di(i,c){i&1&&(n(0,"tr")(1,"th",23),l(2,"Name"),o(),n(3,"th",24),l(4,"Phone"),o(),n(5,"th",25),l(6,"Address"),o()())}function ui(i,c){if(i&1&&(n(0,"tr",26)(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o()()),i&2){let e=c.$implicit,r=c.rowIndex,t=u();de("glowing",t.glowingRowIndex()===r),m("pSelectableRow",e),a(2),C(e.name),a(2),C(e.phone||" --- "),a(2),C(e.address||" --- ")}}function _i(i,c){i&1&&(n(0,"tr")(1,"td",27),l(2,"No customers yet!"),o()())}function fi(i,c){if(i&1){let e=v();n(0,"form",28),d("ngSubmit",function(){_(e);let t=u();return f(t.submitCustomer())}),n(1,"div",29)(2,"div",30)(3,"label",31),l(4,"Customer Name"),o(),b(5,"input",32),o(),n(6,"div",30)(7,"label",33),l(8,"Customer Phone"),o(),b(9,"input",34),o(),n(10,"div",35)(11,"label",36),l(12,"Address"),o(),n(13,"textarea",37),l(14,"                    "),o()()()()}if(i&2){let e=u();m("formGroup",e.customerForm),a(5),m("ngClass",_e(2,pi,(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched))))}}function gi(i,c){if(i&1){let e=v();n(0,"p-button",38),d("onClick",function(){_(e);let t=u();return f(t.resetDialog())}),o(),n(1,"p-button",39),d("onClick",function(){_(e);let t=u();return f(t.submitCustomer())}),o()}if(i&2){let e=u();a(),m("loading",e.submitLoading())}}var gt=(()=>{class i{constructor(){this.customerService=y(W),this.confirmationService=y(he),this.paymentDialogVisible=!1,this.customers=this.customerService.customers,this.selectedCustomer=this.customerService.selectedCustomer,this.submitted=!1,this.customerDialogVisible=this.customerService.customerDialogVisible,this.submitLoading=this.customerService.signal_submitItemLoading,this.tableLoading=this.customerService.signal_tableLoading,this.customerForm=new ye({account_id:new L(null),name:new L("",Ce.required),phone:new L(""),address:new L(""),financial_number:new L("")}),this.glowingRowIndex=this.customerService.glowingRowIndex}onKeyDown(e){!this.customerDialogVisible&&!this.paymentDialogVisible&&this.tableSearch.nativeElement.focus()}get name(){return this.customerForm.get("name")}openCustomerDialog(e){this.dialogMode=e,this.dialogMode=="edit"&&this.customerForm.patchValue(this.selectedCustomer()),this.customerDialogVisible.set(!0)}resetDialog(){this.submitted=!1,this.customerForm.reset({}),this.customerDialogVisible.set(!1)}submitCustomer(){return ce(this,null,function*(){this.submitted=!0,this.dialogMode=="add"?this.customerForm.valid&&(yield this.customerService.createCustomer(this.customerForm.value)):this.customerForm.valid&&(yield this.customerService.updateCustomer(this.customerForm.value))})}deleteSelectedCustomer(){this.confirmationService.confirm({key:"home",message:`Are you sure that you want to delete "${this.selectedCustomer().name}"?`,header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.customerService.deleteCustomer(this.selectedCustomer()),this.customerService.selectedCustomer.set(null)}})}resetTable(){this.customerService.getCustomers()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=R({type:i,selectors:[["app-accounts"]],viewQuery:function(r,t){if(r&1&&(k(F,5),k(ai,5)),r&2){let s;B(s=P())&&(t.ct=s.first),B(s=P())&&(t.tableSearch=s.first)}},hostBindings:function(r,t){r&1&&d("keydown",function(p){return t.onKeyDown(p)},!1,$)},decls:27,vars:26,consts:[["tableSearch",""],["ct",""],[1,"grid","md:mr-8","md:ml-8","m-1"],[1,"col-12"],[1,"grid"],[1,"col-8","md:col-4"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["id","globalFilter","pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],[1,"col-4","md:col-2"],["icon","pi pi-refresh","severity","primary","size","small","label","Refresh","styleClass","w-full",3,"onClick","loading"],["pButton","","pRipple","","label","New","icon","pi pi-plus",1,"p-button-success","p-button-sm","w-full",3,"click"],[1,"col-4","md:col-1"],["pButton","","pRipple","","label","Edit","icon","pi pi-file-edit",1,"p-button-warning","p-button-sm","w-full",3,"click","disabled"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash",1,"p-button-danger","p-button-sm","w-full",3,"click","disabled"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","account_id",3,"selectionChange","value","selection","paginator","rows","loading","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"onClose","visible","accounts","selected_account"],["position","top","header","Customers","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],["width","45%"],["width","20%"],["width","30%"],[3,"pSelectableRow"],["colspan","5"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-6"],["for","name"],["id","name","type","text","pInputText","","formControlName","name","autocomplete","off","required","","autofocus","","spellcheck","false",3,"ngClass"],["for","phone"],["id","phone","type","text","autocomplete","on","pInputText","","formControlName","phone","spellcheck","false"],[1,"field","col-12","md:col-12"],["for","address"],["id","address","name","address","rows","3","pInputTextarea","","formControlName","address","spellcheck","false"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Save","icon","pi pi-check","severity","success","size","small",3,"onClick","loading"]],template:function(r,t){if(r&1){let s=v();n(0,"div",2)(1,"div",3)(2,"p-card")(3,"div",4)(4,"div",5)(5,"span",6),b(6,"i",7),n(7,"input",8,0),d("input",function(g){_(s);let Q=A(19);return f(Q.filterGlobal(g.target.value,"contains"))}),o()()(),n(9,"div",9)(10,"p-button",10),d("onClick",function(){return _(s),f(t.resetTable())}),o()(),n(11,"div",9)(12,"button",11),d("click",function(){return _(s),f(t.openCustomerDialog("add"))}),o()(),n(13,"div",12)(14,"button",13),d("click",function(){return _(s),f(t.openCustomerDialog("edit"))}),o()(),n(15,"div",12)(16,"button",14),d("click",function(){return _(s),f(t.deleteSelectedCustomer())}),o()()(),n(17,"div",3)(18,"p-table",15,1),M("selectionChange",function(g){return _(s),V(t.selectedCustomer,g)||(t.selectedCustomer=g),f(g)}),S(20,di,7,0,"ng-template",16)(21,ui,7,6,"ng-template",17)(22,_i,3,0,"ng-template",18),o()()()()(),n(23,"payment-dialog",19),d("onClose",function(){return _(s),f(t.paymentDialogVisible=!1)}),o(),n(24,"p-dialog",20),M("visibleChange",function(g){return _(s),V(t.customerDialogVisible,g)||(t.customerDialogVisible=g),f(g)}),d("onHide",function(){return _(s),f(t.resetDialog())}),S(25,fi,15,4,"ng-template",21)(26,gi,2,1,"ng-template",22),o()}if(r&2){let s,p=A(19);a(7),m("value",p.filters.global==null?null:p.filters.global.value),a(3),m("loading",t.tableLoading()),a(4),m("disabled",!t.selectedCustomer()),a(2),m("disabled",!t.selectedCustomer()),a(2),m("value",t.customers()),E("selection",t.selectedCustomer),m("paginator",!0)("rows",10)("loading",t.tableLoading())("showCurrentPageReport",!0)("rowsPerPageOptions",w(22,li))("alwaysShowPaginator",!0)("globalFilterFields",w(23,si))("filterDelay",0),a(5),m("visible",t.paymentDialogVisible)("accounts",t.customers())("selected_account",(s=t.selectedCustomer())==null?null:s.account_id),a(),U(w(24,mi)),E("visible",t.customerDialogVisible),m("modal",!0)("breakpoints",w(25,ci))}},dependencies:[X,we,be,Z,Se,Te,De,xe,Y,F,We,te,N,ne,ee,ie,$e,z,j]})}}return i})();var hi=[{path:"statements",data:{breadcrumb:"Statements"},component:ae},{path:"debts",data:{breadcrumt:"Debts"},component:ft},{path:"accounts",data:{breadcrumb:"Accounts"},component:gt},{path:"**",redirectTo:"/customers/statements"}],ht=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=K({type:i})}static{this.\u0275inj=G({imports:[se.forChild(hi),se]})}}return i})();var zn=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=K({type:i})}static{this.\u0275inj=G({providers:[I],imports:[ge,ht,Ee,Ve,mt,Pe,Oe,nt,Ke,ke,Re,Ze,Fe,Be,it,at,Ye,tt,Le,Ue,Me,rt,Ie,et,He,Ne,j,oe]})}}return i})();export{zn as CustomersModule};
